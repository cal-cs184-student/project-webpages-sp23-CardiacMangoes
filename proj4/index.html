<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <title>
        CS 184 Project 4 Writeup - HackMD
    </title>
    <link rel="icon" type="image/png" href="https://hackmd.io/favicon.png">
    <link rel="apple-touch-icon" href="https://hackmd.io/apple-touch-icon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css" integrity="sha256-3iu9jgsy9TpTwXKb7bNQzqWekRX7pPK+2OLj3R922fo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/octicons/3.5.0/octicons.min.css" integrity="sha256-QiWfLIsCT02Sdwkogf6YMiQlj4NE84MKkzEMkZnMGdg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/themes/prism.min.css" integrity="sha256-vtR0hSWRc3Tb26iuN2oZHt3KRUomwTufNIf5/4oeCyg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/css/basic/emojify.min.css" integrity="sha256-UOrvMOsSDSrW6szVLe8ZDZezBxh5IoIfgTwdNDgTjiU=" crossorigin="anonymous" />
    <style>
        @import url(https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i|Source+Code+Pro:300,400,500|Source+Sans+Pro:300,300i,400,400i,600,600i|Source+Serif+Pro&subset=latin-ext);.hljs{background:#fff;color:#333;display:block;overflow-x:auto;padding:.5em}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-string,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#a71d5d}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#0086b3}.hljs-built_in,.hljs-builtin-name{color:#005cc5}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#795da3}.hljs-addition{background-color:#eaffea;color:#55a532}.hljs-deletion{background-color:#ffecec;color:#bd2c00}.hljs-link{text-decoration:underline}.markdown-body{word-wrap:break-word;font-size:16px;line-height:1.5}.markdown-body:after,.markdown-body:before{content:"";display:table}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .absent{color:#c00}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-bottom:16px;margin-top:0}.markdown-body hr{background-color:#e7e7e7;border:0;height:.25em;margin:24px 0;padding:0}.markdown-body blockquote{border-left:.25em solid #ddd;color:#777;font-size:16px;padding:0 1em}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body kbd,.popover kbd{background-color:#fcfcfc;border:1px solid;border-color:#ccc #ccc #bbb;border-radius:3px;box-shadow:inset 0 -1px 0 #bbb;color:#555;display:inline-block;font-size:11px;line-height:10px;padding:3px 5px;vertical-align:middle}.markdown-body .loweralpha{list-style-type:lower-alpha}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:600;line-height:1.25;margin-bottom:16px;margin-top:24px}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#000;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1 code,.markdown-body h1 tt,.markdown-body h2 code,.markdown-body h2 tt,.markdown-body h3 code,.markdown-body h3 tt,.markdown-body h4 code,.markdown-body h4 tt,.markdown-body h5 code,.markdown-body h5 tt,.markdown-body h6 code,.markdown-body h6 tt{font-size:inherit}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{border-bottom:1px solid #eee;padding-bottom:.3em}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{color:#777;font-size:.85em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol.no-list,.markdown-body ul.no-list{list-style-type:none;padding:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-bottom:0;margin-top:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{padding-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{font-size:1em;font-style:italic;font-weight:700;margin-top:16px;padding:0}.markdown-body dl dd{margin-bottom:16px;padding:0 16px}.markdown-body table{display:block;overflow:auto;width:100%;word-break:normal;word-break:keep-all}.markdown-body table th{font-weight:700}.markdown-body table td,.markdown-body table th{border:1px solid #ddd;padding:6px 13px}.markdown-body table tr{background-color:#fff;border-top:1px solid #ccc}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{background-color:#fff;box-sizing:initial;max-width:100%}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body .emoji{background-color:initial;max-width:none;vertical-align:text-top}.markdown-body span.frame{display:block;overflow:hidden}.markdown-body span.frame>span{border:1px solid #ddd;display:block;float:left;margin:13px 0 0;overflow:hidden;padding:7px;width:auto}.markdown-body span.frame span img{display:block;float:left}.markdown-body span.frame span span{clear:both;color:#333;display:block;padding:5px 0 0}.markdown-body span.align-center{clear:both;display:block;overflow:hidden}.markdown-body span.align-center>span{display:block;margin:13px auto 0;overflow:hidden;text-align:center}.markdown-body span.align-center span img{margin:0 auto;text-align:center}.markdown-body span.align-right{clear:both;display:block;overflow:hidden}.markdown-body span.align-right>span{display:block;margin:13px 0 0;overflow:hidden;text-align:right}.markdown-body span.align-right span img{margin:0;text-align:right}.markdown-body span.float-left{display:block;float:left;margin-right:13px;overflow:hidden}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{display:block;float:right;margin-left:13px;overflow:hidden}.markdown-body span.float-right>span{display:block;margin:13px auto 0;overflow:hidden;text-align:right}.markdown-body code,.markdown-body tt{background-color:#0000000a;border-radius:3px;font-size:85%;margin:0;padding:.2em 0}.markdown-body code:after,.markdown-body code:before,.markdown-body tt:after,.markdown-body tt:before{content:"\00a0";letter-spacing:-.2em}.markdown-body code br,.markdown-body tt br{display:none}.markdown-body del code{text-decoration:inherit}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{background:#0000;border:0;font-size:100%;margin:0;padding:0;white-space:pre;word-break:normal}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{background-color:#f7f7f7;border-radius:3px;font-size:85%;line-height:1.45;overflow:auto;padding:16px}.markdown-body pre code,.markdown-body pre tt{word-wrap:normal;background-color:initial;border:0;display:inline;line-height:inherit;margin:0;max-width:auto;overflow:visible;padding:0}.markdown-body pre code:after,.markdown-body pre code:before,.markdown-body pre tt:after,.markdown-body pre tt:before{content:normal}.markdown-body .csv-data td,.markdown-body .csv-data th{font-size:12px;line-height:1;overflow:hidden;padding:5px;text-align:left;white-space:nowrap}.markdown-body .csv-data .blob-line-num{background:#fff;border:0;padding:10px 8px 9px;text-align:right}.markdown-body .csv-data tr{border-top:0}.markdown-body .csv-data th{background:#f8f8f8;border-top:0;font-weight:700}.news .alert .markdown-body blockquote{border:0;padding:0 0 0 40px}.activity-tab .news .alert .commits,.activity-tab .news .markdown-body blockquote{padding-left:0}.task-list-item{list-style-type:none}.task-list-item label{font-weight:400}.task-list-item.enabled label{cursor:pointer}.task-list-item+.task-list-item{margin-top:3px}.task-list-item-checkbox{cursor:default!important;float:left;margin:.31em 0 .2em -1.3em!important;vertical-align:middle}.markdown-body{max-width:758px;overflow:visible!important;padding-bottom:40px;padding-top:40px;position:relative}.markdown-body .emoji{vertical-align:top}.markdown-body pre{border:inherit!important}.markdown-body code{color:inherit!important}.markdown-body pre code .wrapper{display:-moz-inline-flex;display:-ms-inline-flex;display:-o-inline-flex;display:inline-flex}.markdown-body pre code .gutter{float:left;overflow:hidden;-webkit-user-select:none;user-select:none}.markdown-body pre code .gutter.linenumber{border-right:3px solid #6ce26c!important;box-sizing:initial;color:#afafaf!important;cursor:default;display:inline-block;min-width:20px;padding:0 8px 0 0;position:relative;text-align:right;z-index:4}.markdown-body pre code .gutter.linenumber>span:before{content:attr(data-linenumber)}.markdown-body pre code .code{float:left;margin:0 0 0 16px}.markdown-body .gist .line-numbers{border-bottom:none;border-left:none;border-top:none}.markdown-body .gist .line-data{border:none}.markdown-body .gist table{border-collapse:inherit!important;border-spacing:0}.markdown-body code[data-gist-id]{background:none;padding:0}.markdown-body code[data-gist-id]:after,.markdown-body code[data-gist-id]:before{content:""}.markdown-body code[data-gist-id] .blob-num{border:unset}.markdown-body code[data-gist-id] table{margin-bottom:unset;overflow:unset}.markdown-body code[data-gist-id] table tr{background:unset}.markdown-body[dir=rtl] pre{direction:ltr}.markdown-body[dir=rtl] code{direction:ltr;unicode-bidi:embed}.markdown-body .alert>p:last-child{margin-bottom:0}.markdown-body pre.abc,.markdown-body pre.flow-chart,.markdown-body pre.graphviz,.markdown-body pre.mermaid,.markdown-body pre.sequence-diagram,.markdown-body pre.vega{background-color:inherit;border-radius:0;overflow:visible;text-align:center;white-space:inherit}.markdown-body pre.abc>code,.markdown-body pre.flow-chart>code,.markdown-body pre.graphviz>code,.markdown-body pre.mermaid>code,.markdown-body pre.sequence-diagram>code,.markdown-body pre.vega>code{text-align:left}.markdown-body pre.abc>svg,.markdown-body pre.flow-chart>svg,.markdown-body pre.graphviz>svg,.markdown-body pre.mermaid>svg,.markdown-body pre.sequence-diagram>svg,.markdown-body pre.vega>svg{height:100%;max-width:100%}.markdown-body pre>code.wrap{word-wrap:break-word;white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap}.markdown-body .alert>p:last-child,.markdown-body .alert>ul:last-child{margin-bottom:0}.markdown-body summary{display:list-item}.markdown-body summary:focus{outline:none}.markdown-body details summary{cursor:pointer}.markdown-body details:not([open])>:not(summary){display:none}.markdown-body figure{margin:1em 40px}.markdown-body .mark,.markdown-body mark{background-color:#fff1a7}.vimeo,.youtube{background-color:#000;background-position:50%;background-repeat:no-repeat;background-size:contain;cursor:pointer;display:table;overflow:hidden;text-align:center}.vimeo,.youtube{position:relative;width:100%}.youtube{padding-bottom:56.25%}.vimeo img{object-fit:contain;width:100%;z-index:0}.youtube img{object-fit:cover;z-index:0}.vimeo iframe,.youtube iframe,.youtube img{height:100%;left:0;position:absolute;top:0;width:100%}.vimeo iframe,.youtube iframe{vertical-align:middle;z-index:1}.vimeo .icon,.youtube .icon{color:#fff;height:auto;left:50%;opacity:.3;position:absolute;top:50%;transform:translate(-50%,-50%);transition:opacity .2s;width:auto;z-index:0}.vimeo:hover .icon,.youtube:hover .icon{opacity:.6;transition:opacity .2s}.slideshare .inner,.speakerdeck .inner{position:relative;width:100%}.slideshare .inner iframe,.speakerdeck .inner iframe{bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:100%}.figma{display:table;padding-bottom:56.25%;position:relative;width:100%}.figma iframe{border:1px solid #eee;bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:100%}.markmap-container{height:300px}.markmap-container>svg{height:100%;width:100%}.MJX_Assistive_MathML{display:none}#MathJax_Message{z-index:1000!important}.ui-infobar{color:#777;margin:25px auto -25px;max-width:760px;position:relative;z-index:2}.toc .invisable-node{list-style-type:none}.ui-toc{bottom:20px;position:fixed;z-index:998}.ui-toc.both-mode{margin-left:8px}.ui-toc.both-mode .ui-toc-label{border-bottom-left-radius:0;border-top-left-radius:0;height:40px;padding:10px 4px}.ui-toc-label{background-color:#e6e6e6;border:none;color:#868686;transition:opacity .2s}.ui-toc .open .ui-toc-label{color:#fff;opacity:1;transition:opacity .2s}.ui-toc-label:focus{background-color:#ccc;color:#000;opacity:.3}.ui-toc-label:hover{background-color:#ccc;opacity:1;transition:opacity .2s}.ui-toc-dropdown{margin-bottom:20px;margin-top:20px;max-height:70vh;max-width:45vw;overflow:auto;padding-left:10px;padding-right:10px;text-align:inherit;width:25vw}.ui-toc-dropdown>.toc{max-height:calc(70vh - 100px);overflow:auto}.ui-toc-dropdown[dir=rtl] .nav{letter-spacing:.0029em;padding-right:0}.ui-toc-dropdown a{overflow:hidden;text-overflow:ellipsis;white-space:pre}.ui-toc-dropdown .nav>li>a{color:#767676;display:block;font-size:13px;font-weight:500;padding:4px 20px}.ui-toc-dropdown .nav>li:first-child:last-child>ul,.ui-toc-dropdown .toc.expand ul{display:block}.ui-toc-dropdown .nav>li>a:focus,.ui-toc-dropdown .nav>li>a:hover{background-color:initial;border-left:1px solid #000;color:#000;padding-left:19px;text-decoration:none}.ui-toc-dropdown[dir=rtl] .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav>li>a:hover{border-left:none;border-right:1px solid #000;padding-right:19px}.ui-toc-dropdown .nav>.active:focus>a,.ui-toc-dropdown .nav>.active:hover>a,.ui-toc-dropdown .nav>.active>a{background-color:initial;border-left:2px solid #000;color:#000;font-weight:700;padding-left:18px}.ui-toc-dropdown[dir=rtl] .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav>.active>a{border-left:none;border-right:2px solid #000;padding-right:18px}.ui-toc-dropdown .nav .nav{display:none;padding-bottom:10px}.ui-toc-dropdown .nav>.active>ul{display:block}.ui-toc-dropdown .nav .nav>li>a{font-size:12px;font-weight:400;padding-bottom:1px;padding-left:30px;padding-top:1px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a{padding-right:30px}.ui-toc-dropdown .nav .nav>li>ul>li>a{font-size:12px;font-weight:400;padding-bottom:1px;padding-left:40px;padding-top:1px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a{padding-right:40px}.ui-toc-dropdown .nav .nav>li>a:focus,.ui-toc-dropdown .nav .nav>li>a:hover{padding-left:29px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:hover{padding-right:29px}.ui-toc-dropdown .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown .nav .nav>li>ul>li>a:hover{padding-left:39px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:hover{padding-right:39px}.ui-toc-dropdown .nav .nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>a{font-weight:500;padding-left:28px}.ui-toc-dropdown[dir=rtl] .nav .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>a{padding-right:28px}.ui-toc-dropdown .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>a{font-weight:500;padding-left:38px}.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>a{padding-right:38px}.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang^=ja] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang=zh-tw] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang=zh-cn] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html .markdown-body[lang^=ja]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html .markdown-body[lang=zh-tw]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html .markdown-body[lang=zh-cn]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang^=ja] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ Ｐゴシック,sans-serif}html[lang=zh-tw] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html[lang=zh-cn] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}html .ui-toc-dropdown[lang^=ja]{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ Ｐゴシック,sans-serif}html .ui-toc-dropdown[lang=zh-tw]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html .ui-toc-dropdown[lang=zh-cn]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}.ui-affix-toc{max-height:70vh;max-width:15vw;overflow:auto;position:fixed;top:0}.back-to-top,.expand-toggle,.go-to-bottom{color:#999;display:block;font-size:12px;font-weight:500;margin-left:10px;margin-top:10px;padding:4px 10px}.back-to-top:focus,.back-to-top:hover,.expand-toggle:focus,.expand-toggle:hover,.go-to-bottom:focus,.go-to-bottom:hover{color:#563d7c;text-decoration:none}.back-to-top,.go-to-bottom{margin-top:0}.ui-user-icon{background-position:50%;background-repeat:no-repeat;background-size:cover;border-radius:50%;display:block;height:20px;margin-bottom:2px;margin-right:5px;margin-top:2px;width:20px}.ui-user-icon.small{display:inline-block;height:18px;margin:0 0 .2em;vertical-align:middle;width:18px}.ui-infobar>small>span{line-height:22px}.ui-infobar>small .dropdown{display:inline-block}.ui-infobar>small .dropdown a:focus,.ui-infobar>small .dropdown a:hover{text-decoration:none}.ui-more-info{color:#888;cursor:pointer;vertical-align:middle}.ui-more-info .fa{font-size:16px}.ui-connectedGithub,.ui-published-note{color:#888}.ui-connectedGithub{line-height:23px;white-space:nowrap}.ui-connectedGithub a.file-path{color:#888;padding-left:22px;text-decoration:none}.ui-connectedGithub a.file-path:active,.ui-connectedGithub a.file-path:hover{color:#888;text-decoration:underline}.ui-connectedGithub .fa{font-size:20px}.ui-published-note .fa{font-size:20px;vertical-align:top}.unselectable{-webkit-user-select:none;-o-user-select:none;user-select:none}.selectable{-webkit-user-select:text;-o-user-select:text;user-select:text}.inline-spoiler-section{cursor:pointer}.inline-spoiler-section .spoiler-text{background-color:#333;border-radius:2px}.inline-spoiler-section .spoiler-text>*{opacity:0}.inline-spoiler-section .spoiler-img{filter:blur(10px)}.inline-spoiler-section.raw{background-color:#333;border-radius:2px}.inline-spoiler-section.raw>*{opacity:0}.inline-spoiler-section.unveil{cursor:auto}.inline-spoiler-section.unveil .spoiler-text{background-color:#3333331a}.inline-spoiler-section.unveil .spoiler-text>*{opacity:1}.inline-spoiler-section.unveil .spoiler-img{filter:none}@media print{blockquote,div,img,pre,table{page-break-inside:avoid!important}a[href]:after{font-size:12px!important}}.markdown-body.slides{color:#222;position:relative;z-index:1}.markdown-body.slides:before{background-color:currentColor;bottom:0;box-shadow:0 0 0 50vw;content:"";display:block;left:0;position:absolute;right:0;top:0;z-index:-1}.markdown-body.slides section[data-markdown]{background-color:#fff;margin-bottom:1.5em;position:relative;text-align:center}.markdown-body.slides section[data-markdown] code{text-align:left}.markdown-body.slides section[data-markdown]:before{content:"";display:block;padding-bottom:56.23%}.markdown-body.slides section[data-markdown]>div:first-child{left:1em;max-height:100%;overflow:hidden;position:absolute;right:1em;top:50%;transform:translateY(-50%)}.markdown-body.slides section[data-markdown]>ul{display:inline-block}.markdown-body.slides>section>section+section:after{border:3px solid #777;content:"";height:1.5em;position:absolute;right:1em;top:-1.5em}.site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,sans-serif}html[lang^=ja] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif}html[lang=zh-tw] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}body{font-smoothing:subpixel-antialiased!important;-webkit-font-smoothing:subpixel-antialiased!important;-moz-osx-font-smoothing:auto!important;-webkit-overflow-scrolling:touch;font-family:Source Sans Pro,Helvetica,Arial,sans-serif;letter-spacing:.025em}html[lang^=ja] body{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif}html[lang=zh-tw] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}abbr[data-original-title],abbr[title]{cursor:help}body.modal-open{overflow-y:auto;padding-right:0!important}svg{text-shadow:none}
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
    <![endif]-->
</head>

<body>
    <div id="doc" class="markdown-body container-fluid comment-inner comment-enabled" data-hard-breaks="true"><h1 id="CS-184-Project-4-Writeup" data-id="CS-184-Project-4-Writeup"><a class="anchor hidden-xs" href="#CS-184-Project-4-Writeup" title="CS-184-Project-4-Writeup"><span class="octicon octicon-link"></span></a><span>CS 184 Project 4 Writeup</span></h1><p><span>Tianchen Liu 3034681144, Riley Peterlinz 3036754368</span></p><p><span>Link:</span><br>
<a href="https://cal-cs184-student.github.io/project-webpages-sp23-CardiacMangoes/proj4/index.html" target="_blank" rel="noopener"><span>https://cal-cs184-student.github.io/project-webpages-sp23-CardiacMangoes/proj4/index.html</span></a></p><h2 id="Overview" data-id="Overview"><a class="anchor hidden-xs" href="#Overview" title="Overview"><span class="octicon octicon-link"></span></a><span>Overview</span></h2><p><span>In Part 1 we create a row-major order mesh using point masses and springs (three different types of springs). In Part 2 we first compute total force acting on each point mass from springs and other global factors before using Verlet integration to compute new point mass positions after each timestep. In Part 3 and 4 we handle collision of the point masses between other objects (spheres, planes) as well as other point masses (self-collision).In Part 5 we use GLSL to produce different kinds of lighting shaders.</span></p><h2 id="Part-1" data-id="Part-1"><a class="anchor hidden-xs" href="#Part-1" title="Part-1"><span class="octicon octicon-link"></span></a><span>Part 1</span></h2><h3 id="Implementation" data-id="Implementation"><a class="anchor hidden-xs" href="#Implementation" title="Implementation"><span class="octicon octicon-link"></span></a><span>Implementation</span></h3><p><span>Here, we have the basic structure of the points and springs being initialized in row-major order. Structural and Shearing constraints are along the axes with Shearing constraints being 2x as long as strucutural. Shearing constraints are diagonal.</span></p><p><span>The initial masses depends on the orientation of the plane and checks if a mass is pinned or not.</span></p><pre><code class="wrap cpp hljs"><span class="token keyword">double</span> x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z<span class="token punctuation">;</span>

<span class="token keyword">float</span> dw <span class="token operator">=</span> width <span class="token operator">/</span> <span class="token punctuation">(</span>num_width_points <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">float</span> dh <span class="token operator">=</span> height <span class="token operator">/</span> <span class="token punctuation">(</span>num_height_points <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// masses</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> num_height_points<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> num_width_points<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

       x <span class="token operator">=</span> dw <span class="token operator">*</span> i<span class="token punctuation">;</span>

       <span class="token comment">// xz plane</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>orientation <span class="token operator">==</span> HORIZONTAL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           z <span class="token operator">=</span> dh <span class="token operator">*</span> j<span class="token punctuation">;</span>
           y <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token comment">// xy plane</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>orientation <span class="token operator">==</span> VERTICAL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           y <span class="token operator">=</span> dh <span class="token operator">*</span> j<span class="token punctuation">;</span>
           z <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">0.5</span> <span class="token operator">*</span> RAND_MAX<span class="token punctuation">)</span><span class="token punctuation">;</span>
           z <span class="token operator">/=</span> RAND_MAX<span class="token punctuation">;</span>
           z <span class="token operator">/=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token keyword">bool</span> pinned_bool <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> v <span class="token operator">:</span> pinned<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">==</span> v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           pinned_bool <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
       point_masses<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span><span class="token function">Vector3D</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">,</span> pinned_bool<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p><span>Initializing the springs has conditions for whether you are on the edge of the plane. For example, if you are at the top edge, you cannot place a </span><code>STRUCTURAL</code><span> spring on the mass above it as it does not exist!</span></p><pre><code class="wrap cpp hljs"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> num_height_points<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> num_width_points<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

             target <span class="token operator">=</span> <span class="token operator">&amp;</span>point_masses<span class="token punctuation">[</span>num_width_points <span class="token operator">*</span> i <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">;</span>

             <span class="token comment">// STRUCTURAL</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                 left <span class="token operator">=</span> <span class="token operator">&amp;</span>point_masses<span class="token punctuation">[</span>num_width_points <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token punctuation">(</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                 springs<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> left<span class="token punctuation">,</span> STRUCTURAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                 above <span class="token operator">=</span> <span class="token operator">&amp;</span>point_masses<span class="token punctuation">[</span>num_width_points <span class="token operator">*</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">;</span>
                 springs<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> above<span class="token punctuation">,</span> STRUCTURAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>

             <span class="token comment">// SHEARING</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                 above_left <span class="token operator">=</span> <span class="token operator">&amp;</span>point_masses<span class="token punctuation">[</span>num_width_points <span class="token operator">*</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                 springs<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> above_left<span class="token punctuation">,</span> SHEARING<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token punctuation">(</span>num_width_points <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                 above_right <span class="token operator">=</span> <span class="token operator">&amp;</span>point_masses<span class="token punctuation">[</span>num_width_points <span class="token operator">*</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                 springs<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> above_right<span class="token punctuation">,</span> SHEARING<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>

             <span class="token comment">// BENDING</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                 left_two <span class="token operator">=</span> <span class="token operator">&amp;</span>point_masses<span class="token punctuation">[</span>num_width_points <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token punctuation">(</span>j <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                 springs<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> left_two<span class="token punctuation">,</span> BENDING<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                 above_two <span class="token operator">=</span> <span class="token operator">&amp;</span>point_masses<span class="token punctuation">[</span>num_width_points <span class="token operator">*</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">;</span>
                 springs<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> above_two<span class="token punctuation">,</span> BENDING<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>

         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
</code></pre><h3 id="Results" data-id="Results"><a class="anchor hidden-xs" href="#Results" title="Results"><span class="octicon octicon-link"></span></a><span>Results</span></h3><p><span>No Shearing Constraints</span><br>
<img src="https://i.imgur.com/svBjP8K.png" alt="" loading="lazy"></p><p><span>Just Shearing Contsraints</span><br>
<img src="https://i.imgur.com/6wE3Q4X.png" alt="" loading="lazy"></p><p><span>All Constraints</span><br>
<img src="https://i.imgur.com/iGTlKYp.png" alt="" loading="lazy"></p><h2 id="Part-2" data-id="Part-2"><a class="anchor hidden-xs" href="#Part-2" title="Part-2"><span class="octicon octicon-link"></span></a><span>Part 2</span></h2><h3 id="Implemenation" data-id="Implemenation"><a class="anchor hidden-xs" href="#Implemenation" title="Implemenation"><span class="octicon octicon-link"></span></a><span>Implemenation</span></h3><p><span>We first iterate through the point masses to find the force due to external accelerations</span></p><pre><code class="wrap cpp hljs"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> point_masses<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        PointMass <span class="token operator">*</span>pm <span class="token operator">=</span> <span class="token operator">&amp;</span>point_masses<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> external_accelerations<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            pm<span class="token operator">-&gt;</span>forces <span class="token operator">+=</span> mass <span class="token operator">*</span> external_accelerations<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><p><span>Then, for each spring we calculate the net force on each of its point masses by considering what type of constraints are on the point mass. These are internal forces.</span></p><pre><code class="wrap cpp hljs"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> springs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Spring<span class="token operator">*</span> spring <span class="token operator">=</span> <span class="token operator">&amp;</span>springs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">float</span> k_s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> d <span class="token operator">=</span> <span class="token punctuation">(</span>spring<span class="token operator">-&gt;</span>pm_a<span class="token operator">-&gt;</span>position <span class="token operator">-</span> spring<span class="token operator">-&gt;</span>pm_b<span class="token operator">-&gt;</span>position<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">norm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> spring<span class="token operator">-&gt;</span>rest_length<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>cp<span class="token operator">-&gt;</span>enable_structural_constraints<span class="token punctuation">)</span> k_s <span class="token operator">+=</span> cp<span class="token operator">-&gt;</span>ks<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cp<span class="token operator">-&gt;</span>enable_shearing_constraints<span class="token punctuation">)</span> k_s <span class="token operator">+=</span> cp<span class="token operator">-&gt;</span>ks<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cp<span class="token operator">-&gt;</span>enable_bending_constraints<span class="token punctuation">)</span> k_s <span class="token operator">+=</span> cp<span class="token operator">-&gt;</span>ks <span class="token operator">*</span> <span class="token number">0.2</span><span class="token punctuation">;</span>

    spring<span class="token operator">-&gt;</span>pm_a<span class="token operator">-&gt;</span>forces <span class="token operator">+=</span> k_s <span class="token operator">*</span> d <span class="token operator">*</span> <span class="token punctuation">(</span>spring<span class="token operator">-&gt;</span>pm_b<span class="token operator">-&gt;</span>position <span class="token operator">-</span> spring<span class="token operator">-&gt;</span>pm_a<span class="token operator">-&gt;</span>position<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    spring<span class="token operator">-&gt;</span>pm_b<span class="token operator">-&gt;</span>forces <span class="token operator">+=</span> k_s <span class="token operator">*</span> d <span class="token operator">*</span> <span class="token punctuation">(</span>spring<span class="token operator">-&gt;</span>pm_a<span class="token operator">-&gt;</span>position <span class="token operator">-</span> spring<span class="token operator">-&gt;</span>pm_b<span class="token operator">-&gt;</span>position<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><span>Next, we use Verlet Integration to calculate the new position given the forces on the point mass</span></p><pre><code class="wrap cpp hljs"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> point_masses<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      PointMass <span class="token operator">*</span>pm <span class="token operator">=</span> <span class="token operator">&amp;</span>point_masses<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>pm<span class="token operator">-&gt;</span>pinned <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          Vector3D prev <span class="token operator">=</span> pm<span class="token operator">-&gt;</span>last_position<span class="token punctuation">;</span>
          Vector3D curr <span class="token operator">=</span> pm<span class="token operator">-&gt;</span>position<span class="token punctuation">;</span>
          pm<span class="token operator">-&gt;</span>position <span class="token operator">=</span> curr <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span><span class="token punctuation">(</span>cp<span class="token operator">-&gt;</span>damping<span class="token operator">/</span><span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>curr <span class="token operator">-</span> prev<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pm<span class="token operator">-&gt;</span>forces <span class="token operator">/</span> mass<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">pow</span><span class="token punctuation">(</span>delta_t<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          pm<span class="token operator">-&gt;</span>last_position <span class="token operator">=</span> curr<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      pm<span class="token operator">-&gt;</span>forces <span class="token operator">=</span> <span class="token function">Vector3D</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><p><span>Finally, we constrain the changes to be such that the spring does not change in length more than 10% per timestep [Provot 1995]</span></p><pre><code class="wrap cpp hljs"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> springs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Spring <span class="token operator">*</span>spring <span class="token operator">=</span> <span class="token operator">&amp;</span>springs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  PointMass <span class="token operator">*</span>pm_a <span class="token operator">=</span> spring<span class="token operator">-&gt;</span>pm_a<span class="token punctuation">;</span>
  PointMass <span class="token operator">*</span>pm_b <span class="token operator">=</span> spring<span class="token operator">-&gt;</span>pm_b<span class="token punctuation">;</span>

  <span class="token keyword">double</span> spring_length <span class="token operator">=</span> <span class="token punctuation">(</span>pm_a<span class="token operator">-&gt;</span>position <span class="token operator">-</span> pm_b<span class="token operator">-&gt;</span>position<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">norm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">double</span> extra_length <span class="token operator">=</span> spring_length <span class="token operator">-</span> <span class="token punctuation">(</span>spring<span class="token operator">-&gt;</span>rest_length <span class="token operator">*</span> <span class="token number">1.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>extra_length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>pm_a<span class="token operator">-&gt;</span>pinned<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          pm_b<span class="token operator">-&gt;</span>position <span class="token operator">+=</span> extra_length <span class="token operator">*</span> <span class="token punctuation">(</span>pm_a<span class="token operator">-&gt;</span>position <span class="token operator">-</span> pm_b<span class="token operator">-&gt;</span>position<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pm_b<span class="token operator">-&gt;</span>pinned<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          pm_a<span class="token operator">-&gt;</span>position <span class="token operator">+=</span> extra_length <span class="token operator">*</span> <span class="token punctuation">(</span>pm_b<span class="token operator">-&gt;</span>position <span class="token operator">-</span> pm_a<span class="token operator">-&gt;</span>position<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pm_a<span class="token operator">-&gt;</span>pinned <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>pm_b<span class="token operator">-&gt;</span>pinned<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          pm_b<span class="token operator">-&gt;</span>position <span class="token operator">+=</span> extra_length <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>pm_a<span class="token operator">-&gt;</span>position <span class="token operator">-</span> pm_b<span class="token operator">-&gt;</span>position<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          pm_a<span class="token operator">-&gt;</span>position <span class="token operator">+=</span> extra_length <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>pm_b<span class="token operator">-&gt;</span>position <span class="token operator">-</span> pm_a<span class="token operator">-&gt;</span>position<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="Results1" data-id="Results"><a class="anchor hidden-xs" href="#Results1" title="Results1"><span class="octicon octicon-link"></span></a><span>Results</span></h3><p><span>After simulation, the state with default parameters</span></p><p><code>ks = 5000 N/m</code><br>
<code>density = 15 g/cm^2</code><br>
<code>dampening = 0.2%</code></p><p><img src="https://i.imgur.com/emx3BrA.png" alt="" loading="lazy"></p><h4 id="ks" data-id="ks"><a class="anchor hidden-xs" href="#ks" title="ks"><span class="octicon octicon-link"></span></a><code>ks</code></h4><p><code>ks</code><span> is the measure of how tight or loose a spring is. Small </span><code>ks</code><span> makes a spring loose while large </span><code>ks</code><span> makes the spring tight.</span></p><p><code>ks = 10 N/m</code><br>
<code>density = 15 g/cm^2</code><br>
<code>dampening = 0.2%</code></p><p><img src="https://i.imgur.com/67Q0iH5.jpg" alt="" loading="lazy"></p><p><code>ks = 50000 N/m</code><br>
<code>density = 15 g/cm^2</code><br>
<code>dampening = 0.2%</code></p><p><img src="https://i.imgur.com/G2ENcHr.jpg" alt="" loading="lazy"></p><h4 id="density" data-id="density"><a class="anchor hidden-xs" href="#density" title="density"><span class="octicon octicon-link"></span></a><code>density</code></h4><p><code>density</code><span> affects the weight of our masses, so it will make the cloth tighter when </span><code>density</code><span> is low and will cause more sagging when </span><code>density</code><span> is high.</span></p><p><code>ks = 5000 N/m</code><br>
<code>density = 1 g/cm^2</code><br>
<code>dampening = 0.2%</code></p><p><img src="https://i.imgur.com/n0Uoan2.png" alt="" loading="lazy"></p><p><code>ks = 5000 N/m</code><br>
<code>density = 50 g/cm^2</code><br>
<code>dampening = 0.2%</code></p><p><img src="https://i.imgur.com/fDFraKW.jpg" alt="" loading="lazy"></p><h3 id="dampening" data-id="dampening"><a class="anchor hidden-xs" href="#dampening" title="dampening"><span class="octicon octicon-link"></span></a><code>dampening</code></h3><p><span>Unlike </span><code>ks</code><span> and </span><code>density</code><span>, </span><code>dampening</code><span> affects only the motion of the cloth, not its final resting state. With low </span><code>dampening</code><span>, more energy is conserved and thus the cloth will seem “bouncier”, like a rubber sheet in the air. With high </span><code>dampening</code><span> the sheet of cloth falls slower and has less “fidgety” behavior.</span></p><p><code>ks = 5000 N/m</code><br>
<code>density = 50 g/cm^2</code><br>
<code>dampening = 0%</code></p><p><img src="https://i.imgur.com/Nx4Vf1b.jpg" alt="" loading="lazy"></p><p><code>ks = 5000 N/m</code><br>
<code>density = 50 g/cm^2</code><br>
<code>dampening = 1%</code></p><p><img src="https://i.imgur.com/U0xi5Ap.png" alt="" loading="lazy"></p><h2 id="Part-3" data-id="Part-3"><a class="anchor hidden-xs" href="#Part-3" title="Part-3"><span class="octicon octicon-link"></span></a><span>Part 3</span></h2><h3 id="Implementation1" data-id="Implementation"><a class="anchor hidden-xs" href="#Implementation1" title="Implementation1"><span class="octicon octicon-link"></span></a><span>Implementation</span></h3><p><span>To handle collisions with object privitives, we simply loop over each point mass and each primitive to check their collisions</span></p><pre><code class="wrap cpp hljs"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>obj <span class="token operator">:</span> <span class="token operator">*</span>collision_objects<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>pm <span class="token operator">:</span> point_masses<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      obj<span class="token operator">-&gt;</span><span class="token function">collide</span><span class="token punctuation">(</span>pm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre><h3 id="Sphere" data-id="Sphere"><a class="anchor hidden-xs" href="#Sphere" title="Sphere"><span class="octicon octicon-link"></span></a><span>Sphere</span></h3><h4 id="Implementation2" data-id="Implementation"><a class="anchor hidden-xs" href="#Implementation2" title="Implementation2"><span class="octicon octicon-link"></span></a><span>Implementation</span></h4><p><span>Collisions are radially outward thus the tangent vector is in the direction away from the origin at all times</span></p><pre><code class="wrap cpp hljs"><span class="token keyword">float</span> distance <span class="token operator">=</span> <span class="token punctuation">(</span>pm<span class="token punctuation">.</span>position <span class="token operator">-</span> origin<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">norm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>distance <span class="token operator">&lt;=</span> radius<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">auto</span> dir <span class="token operator">=</span> <span class="token punctuation">(</span>pm<span class="token punctuation">.</span>position <span class="token operator">-</span> origin<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> tangent_point <span class="token operator">=</span> origin <span class="token operator">+</span> dir <span class="token operator">*</span> radius<span class="token punctuation">;</span>
    <span class="token keyword">auto</span> correction_vector <span class="token operator">=</span> <span class="token punctuation">(</span>tangent_point <span class="token operator">-</span> pm<span class="token punctuation">.</span>last_position<span class="token punctuation">)</span><span class="token punctuation">;</span>
    pm<span class="token punctuation">.</span>position <span class="token operator">=</span> pm<span class="token punctuation">.</span>last_position <span class="token operator">+</span> correction_vector <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> friction<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><h4 id="Result" data-id="Result"><a class="anchor hidden-xs" href="#Result" title="Result"><span class="octicon octicon-link"></span></a><span>Result</span></h4><p><span>We vary </span><code>ks</code><span> to notice as </span><code>ks</code><span> grows, the cloth falls on the sphere more rigidly</span></p><p><code>ks = 500 N/m</code><br>
<code>density = 15 g/cm^2</code><br>
<code>dampening = 0.2%</code></p><p><img src="https://i.imgur.com/yZ64heA.jpg" alt="" loading="lazy"></p><p><code>ks = 5000 N/m</code><br>
<code>density = 15 g/cm^2</code><br>
<code>dampening = 0.2%</code></p><p><img src="https://i.imgur.com/VfSxynG.jpg" alt="" loading="lazy"></p><p><code>ks = 50000 N/m</code><br>
<code>density = 15 g/cm^2</code><br>
<code>dampening = 0.2%</code></p><p><img src="https://i.imgur.com/eVWCYJW.png" alt="" loading="lazy"></p><h3 id="Plane" data-id="Plane"><a class="anchor hidden-xs" href="#Plane" title="Plane"><span class="octicon octicon-link"></span></a><span>Plane</span></h3><h4 id="Implementation3" data-id="Implementation"><a class="anchor hidden-xs" href="#Implementation3" title="Implementation3"><span class="octicon octicon-link"></span></a><span>Implementation</span></h4><p><span>For collision, we simply look at the normal vs the direction of our point mass compared with the plane and make sure to correct the point to above the plane slightly on the side it is entering from.</span></p><pre><code class="wrap cpp hljs">Vector3D dir <span class="token operator">=</span> pm<span class="token punctuation">.</span>position <span class="token operator">-</span> point<span class="token punctuation">;</span>

<span class="token keyword">float</span> costheta <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>costheta <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">float</span> offset <span class="token operator">=</span> SURFACE_OFFSET <span class="token operator">-</span> costheta<span class="token punctuation">;</span>
  Vector3D correction <span class="token operator">=</span> <span class="token punctuation">(</span>pm<span class="token punctuation">.</span>position <span class="token operator">+</span> normal <span class="token operator">*</span> offset<span class="token punctuation">)</span> <span class="token operator">-</span> pm<span class="token punctuation">.</span>last_position<span class="token punctuation">;</span>
  pm<span class="token punctuation">.</span>position <span class="token operator">=</span> pm<span class="token punctuation">.</span>last_position <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>friction<span class="token punctuation">)</span> <span class="token operator">*</span> correction<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="Result1" data-id="Result"><a class="anchor hidden-xs" href="#Result1" title="Result1"><span class="octicon octicon-link"></span></a><span>Result</span></h4><p><span>A plane of cloth lying peacefully at rest on a plane</span></p><p><img src="https://i.imgur.com/CZY2Jm5.png" alt="" loading="lazy"></p><h2 id="Part-4" data-id="Part-4"><a class="anchor hidden-xs" href="#Part-4" title="Part-4"><span class="octicon octicon-link"></span></a><span>Part 4</span></h2><h3 id="Implementation4" data-id="Implementation"><a class="anchor hidden-xs" href="#Implementation4" title="Implementation4"><span class="octicon octicon-link"></span></a><span>Implementation</span></h3><p><span>First, we have to build a spatial map for efficient positional encoding for self-collisions. We first map a small box of the cloth to a hash like so:</span></p><pre><code class="wrap cpp hljs"><span class="token keyword">float</span> <span class="token class-name">Cloth</span><span class="token double-colon punctuation">::</span><span class="token function">hash_position</span><span class="token punctuation">(</span>Vector3D pos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">float</span> w <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">*</span> width <span class="token operator">/</span> num_width_points<span class="token punctuation">;</span>
  <span class="token keyword">float</span> h <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">*</span> height <span class="token operator">/</span> num_height_points<span class="token punctuation">;</span>
  <span class="token keyword">float</span> t <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">float</span> x <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x <span class="token operator">/</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">float</span> y <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>y <span class="token operator">/</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">float</span> z <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>z <span class="token operator">/</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// raise values to powers in order to keep unique</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><span>We take the floor to get discrete values, then power and sum them to spreead the hash out so we are less likely to get multiple hits in a single box.</span></p><p><span>Nowe, we actually build the spatial map using our hashing. This basically hashes the position which is a key in a hashmap to find close points.</span></p><pre><code class="wrap cpp hljs"><span class="token keyword">void</span> <span class="token class-name">Cloth</span><span class="token double-colon punctuation">::</span><span class="token function">build_spatial_map</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span> <span class="token operator">&amp;</span>entry <span class="token operator">:</span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">delete</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  map<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> point_masses<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      PointMass<span class="token operator">*</span> pm <span class="token operator">=</span> <span class="token operator">&amp;</span>point_masses<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">// Key is not present</span>
      <span class="token keyword">float</span> hash <span class="token operator">=</span> <span class="token function">hash_position</span><span class="token punctuation">(</span>pm<span class="token operator">-&gt;</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>hash<span class="token punctuation">)</span> <span class="token operator">==</span> map<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          map<span class="token punctuation">[</span>hash<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>PointMass<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      map<span class="token punctuation">[</span>hash<span class="token punctuation">]</span><span class="token operator">-&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span>pm<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><p><span>The actual self-collision will take close point masses (that are not itself) and then if the points are less than </span><code>2 * thickness</code><span> away from each other, we can then seperate them so they are at least </span><code>2 * thickness</code><span> apart. We average over all the close points corrections, dividing by the simulation steps to keep the simulation temporaly consistent.</span></p><pre><code class="wrap cpp hljs"><span class="token keyword">void</span> <span class="token class-name">Cloth</span><span class="token double-colon punctuation">::</span><span class="token function">self_collide</span><span class="token punctuation">(</span>PointMass <span class="token operator">&amp;</span>pm<span class="token punctuation">,</span> <span class="token keyword">double</span> simulation_steps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// TODO (Part 4): Handle self-collision for a given point mass.</span>
  <span class="token keyword">float</span> hash <span class="token operator">=</span> <span class="token function">hash_position</span><span class="token punctuation">(</span>pm<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// correction initialization</span>
  Vector3D <span class="token function">correction</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> correction_count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// for averaging</span>

  <span class="token keyword">auto</span> close_points <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>map<span class="token punctuation">[</span>hash<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// separation between pm and close_pm</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>PointMass<span class="token operator">*</span> close_pm <span class="token operator">:</span> close_points<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token operator">*</span>close_pm <span class="token operator">==</span> <span class="token operator">&amp;</span>pm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span><span class="token punctuation">{</span>
          Vector3D separation <span class="token operator">=</span> <span class="token punctuation">(</span>close_pm<span class="token operator">-&gt;</span>position <span class="token operator">-</span> pm<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>separation<span class="token punctuation">.</span><span class="token function">norm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token operator">*</span> thickness<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              correction <span class="token operator">+=</span> separation <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> thickness <span class="token operator">*</span> separation<span class="token punctuation">.</span><span class="token function">unit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              correction_count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>correction_count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      correction <span class="token operator">/=</span> correction_count<span class="token punctuation">;</span>
      correction <span class="token operator">/=</span> simulation_steps<span class="token punctuation">;</span>
      pm<span class="token punctuation">.</span>position <span class="token operator">+=</span> correction<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><p><span>In </span><code>simulate</code><span> we just call </span><code>self_collide</code><span> on all the point masses</span></p><pre><code class="wrap cpp hljs"><span class="token function">build_spatial_map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> point_masses<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    PointMass<span class="token operator">*</span> pm <span class="token operator">=</span> <span class="token operator">&amp;</span>point_masses<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">self_collide</span><span class="token punctuation">(</span><span class="token operator">*</span>pm<span class="token punctuation">,</span> simulation_steps<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="Results2" data-id="Results"><a class="anchor hidden-xs" href="#Results2" title="Results2"><span class="octicon octicon-link"></span></a><span>Results</span></h3><h4 id="Falling-Sequence" data-id="Falling-Sequence"><a class="anchor hidden-xs" href="#Falling-Sequence" title="Falling-Sequence"><span class="octicon octicon-link"></span></a><span>Falling Sequence</span></h4><p><img src="https://i.imgur.com/QNKnVyS.png" alt="" loading="lazy"><br>
<img src="https://i.imgur.com/oFnNZbZ.png" alt="" loading="lazy"><br>
<img src="https://i.imgur.com/1pYuRIW.png" alt="" loading="lazy"><br>
<img src="https://i.imgur.com/UAHtlp7.png" alt="" loading="lazy"></p><h4 id="density-vs-ks" data-id="density-vs-ks"><a class="anchor hidden-xs" href="#density-vs-ks" title="density-vs-ks"><span class="octicon octicon-link"></span></a><code>density</code><span> vs </span><code>ks</code></h4><p><span>Lower </span><code>density</code><span> causes the cloth to be flatter when it falls since it is light and can spread away from itself given self-collision</span></p><p><img src="https://i.imgur.com/QmL0gn5.png" alt="" loading="lazy"></p><p><span>Higher </span><code>density</code><span> causes it to clump onto itself since it is heavier now and weighs itself down so self-collision doesn’t have as large of an effect</span></p><p><img src="https://i.imgur.com/X5AtXKi.png" alt="" loading="lazy"></p><p><strong><span>The effect of </span><code>ks</code><span> is inverse to </span><code>density</code></strong></p><p><span>Lower </span><code>ks</code><span> causes the cloth to clump onto itself more since the structure becomes loose</span></p><p><img src="https://i.imgur.com/Ng2xEEP.png" alt="" loading="lazy"></p><p><span>Higher </span><code>ks</code><span> causes the cloth to flatten more since it has more rigid structure</span></p><p><img src="https://i.imgur.com/pwblVce.png" alt="" loading="lazy"></p><h2 id="Part-5" data-id="Part-5"><a class="anchor hidden-xs" href="#Part-5" title="Part-5"><span class="octicon octicon-link"></span></a><span>Part 5</span></h2><blockquote>
<p><span>Explain in your own words what is a shader program and how vertex and fragment shaders work together to create lighting and material effects.</span></p>
</blockquote><p><span>Shaders are isolated programs that run in parallel on GPU, executing sections of the graphics pipeline, which makes it faster than the CPU. Good for processing parallelizable stuff like information about each vertex and each triangle formed by three vertices.</span></p><p><span>Vertex shaders change positions, tangents/normals of each vertex, and where the vertex should be in the screen space</span><br>
<span>Fragment shaders takes in info from the vertex shaders and output the color for each area segment formed by the vertices. Together using the vertex shaders in the </span><code>.vert</code><span> files and the fragment shaders in the </span><code>.frag</code><span> files we get lighting and shading effects.</span></p><blockquote>
<p><span>Explain the Blinn-Phong shading model in your own words.</span></p>
</blockquote><p><span>Blinn-Phong shading allows us to create highlights and shading with ambient light and diffuse reflections and specular highlights. It achieves this in three parts in the equation.</span></p><p><img src="https://i.imgur.com/Ed6smGg.png" alt="" loading="lazy"><br>
<span>First term is ambient lighting, second is diffuse reflection, and third is spectural highlights.</span></p><blockquote>
<p><span>Show a screenshot of your Blinn-Phong shader outputting only the ambient component, a screen shot only outputting the diffuse component, a screen shot only outputting the specular component, and one using the entire Blinn-Phong model.</span></p>
</blockquote><p><span>Only ambient component, ka = 0.5, Ia = [1, 1, 1]</span><br>
<img src="https://i.imgur.com/KRQY74Z.png" alt="" loading="lazy"></p><p><span>Only diffuse component, kd = 0.5</span><br>
<img src="https://i.imgur.com/7FCTGMz.png" alt="" loading="lazy"></p><p><span>Only specular component, ks = 0.9, p = 10</span><br>
<img src="https://i.imgur.com/sazNB72.png" alt="" loading="lazy"></p><p><span>Entire Blinn-Phong model, parameters listed above:</span><br>
<img src="https://i.imgur.com/PmVE1rp.png" alt="" loading="lazy"></p><blockquote>
<p><span>Show a screenshot of your texture mapping shader using your own custom texture by modifying the textures in </span><code>/textures/</code><span>.</span></p>
</blockquote><p><span>This is Thom Yorke</span><br>
<img src="https://i.imgur.com/YieFiFE.png" alt="" loading="lazy"></p><blockquote>
<p><span>Show a screenshot of bump mapping on the cloth and on the sphere.</span></p>
</blockquote><p><span>The cloth:</span><br>
<img src="https://i.imgur.com/FyDZiDz.png" alt="" loading="lazy"></p><p><span>The sphere:</span><br>
<img src="https://i.imgur.com/jahf5ol.png" alt="" loading="lazy"></p><blockquote>
<p><span>Show a screenshot of displacement mapping on the sphere.</span></p>
</blockquote><p><img src="https://i.imgur.com/Ms9KFge.png" alt="" loading="lazy"></p><blockquote>
<p><span>Use the same texture for both renders. You can either provide your own texture or use one of the ones in the textures directory, BUT choose one that’s not the default texture_2.png. Compare the two approaches and resulting renders in your own words.</span></p>
</blockquote><p><span>Bump mapping changes the “look” of the render to make it “look” like the texture but it’s actually the same shape (the vertices doesn’t change places). Whereas in displacement mapping, the vertex position is actually displaced to a different position. As you can see, in the rendering of displacement mapping, the sphere is not a strictly perfect sphere anymore.</span></p><blockquote>
<p><span>Compare how your the two shaders react to the sphere by changing the sphere mesh’s coarseness by using -o 16 -a 16 and then -o 128 -a 128.</span></p>
</blockquote><p><span>The less the coarse the mapping is the less detailed the render is. This is especially true in displacement shading more than bump shading. In the following four pictures we can see that there’s really not that much of a difference in bump shading with the two different parameters. But in displacment shading the with param=16 it doesn’t look circular at all, and when param=128 we can see the ups and downs of the bricks.</span></p><p><span>param = 16:</span><br>
<img src="https://i.imgur.com/26YFigS.png" alt="" loading="lazy"></p><p><img src="https://i.imgur.com/TyjHs3f.png" alt="" loading="lazy"></p><p><span>param = 128:</span><br>
<img src="https://i.imgur.com/ayuoTbQ.png" alt="" loading="lazy"></p><p><img src="https://i.imgur.com/yYo64wC.png" alt="" loading="lazy"></p><blockquote>
<p><span>Show a screenshot of your mirror shader on the cloth and on the sphere.</span></p>
</blockquote><p><img src="https://i.imgur.com/9GyBjQF.png" alt="" loading="lazy"><br>
<img src="https://i.imgur.com/xwINJl0.png" alt="" loading="lazy"></p></div>
    <div class="ui-toc dropup unselectable hidden-print" style="display:none;">
        <div class="pull-right dropdown">
            <a id="tocLabel" class="ui-toc-label btn btn-default" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" title="Table of content">
                <i class="fa fa-bars"></i>
            </a>
            <ul id="ui-toc" class="ui-toc-dropdown dropdown-menu" aria-labelledby="tocLabel">
                <div class="toc"><ul class="nav">
<li><a href="#CS-184-Project-4-Writeup" title="CS 184 Project 4 Writeup">CS 184 Project 4 Writeup</a><ul class="nav">
<li><a href="#Overview" title="Overview">Overview</a></li>
<li><a href="#Part-1" title="Part 1">Part 1</a><ul class="nav">
<li><a href="#Implementation" title="Implementation">Implementation</a></li>
<li><a href="#Results" title="Results">Results</a></li>
</ul>
</li>
<li><a href="#Part-2" title="Part 2">Part 2</a><ul class="nav">
<li><a href="#Implemenation" title="Implemenation">Implemenation</a></li>
<li><a href="#Results1" title="Results">Results</a></li>
<li><a href="#dampening" title="dampening">dampening</a></li>
</ul>
</li>
<li><a href="#Part-3" title="Part 3">Part 3</a><ul class="nav">
<li><a href="#Implementation1" title="Implementation">Implementation</a></li>
<li><a href="#Sphere" title="Sphere">Sphere</a></li>
<li><a href="#Plane" title="Plane">Plane</a></li>
</ul>
</li>
<li><a href="#Part-4" title="Part 4">Part 4</a><ul class="nav">
<li><a href="#Implementation4" title="Implementation">Implementation</a></li>
<li><a href="#Results2" title="Results">Results</a></li>
</ul>
</li>
<li><a href="#Part-5" title="Part 5">Part 5</a></li>
</ul>
</li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
            </ul>
        </div>
    </div>
    <div id="ui-toc-affix" class="ui-affix-toc ui-toc-dropdown unselectable hidden-print" data-spy="affix" style="top:17px;display:none;" null null>
        <div class="toc"><ul class="nav">
<li><a href="#CS-184-Project-4-Writeup" title="CS 184 Project 4 Writeup">CS 184 Project 4 Writeup</a><ul class="nav">
<li><a href="#Overview" title="Overview">Overview</a></li>
<li><a href="#Part-1" title="Part 1">Part 1</a><ul class="nav">
<li><a href="#Implementation" title="Implementation">Implementation</a></li>
<li><a href="#Results" title="Results">Results</a></li>
</ul>
</li>
<li><a href="#Part-2" title="Part 2">Part 2</a><ul class="nav">
<li><a href="#Implemenation" title="Implemenation">Implemenation</a></li>
<li><a href="#Results1" title="Results">Results</a></li>
<li><a href="#dampening" title="dampening">dampening</a></li>
</ul>
</li>
<li><a href="#Part-3" title="Part 3">Part 3</a><ul class="nav">
<li><a href="#Implementation1" title="Implementation">Implementation</a></li>
<li><a href="#Sphere" title="Sphere">Sphere</a></li>
<li><a href="#Plane" title="Plane">Plane</a></li>
</ul>
</li>
<li><a href="#Part-4" title="Part 4">Part 4</a><ul class="nav">
<li><a href="#Implementation4" title="Implementation">Implementation</a></li>
<li><a href="#Results2" title="Results">Results</a></li>
</ul>
</li>
<li><a href="#Part-5" title="Part 5">Part 5</a></li>
</ul>
</li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gist-embed/2.6.0/gist-embed.min.js" integrity="sha256-KyF2D6xPIJUW5sUDSs93vWyZm+1RzIpKCexxElmxl8g=" crossorigin="anonymous" defer></script>
    <script>
        var markdown = $(".markdown-body");
        //smooth all hash trigger scrolling
        function smoothHashScroll() {
            var hashElements = $("a[href^='#']").toArray();
            for (var i = 0; i < hashElements.length; i++) {
                var element = hashElements[i];
                var $element = $(element);
                var hash = element.hash;
                if (hash) {
                    $element.on('click', function (e) {
                        // store hash
                        var hash = this.hash;
                        if ($(hash).length <= 0) return;
                        // prevent default anchor click behavior
                        e.preventDefault();
                        // animate
                        $('body, html').stop(true, true).animate({
                            scrollTop: $(hash).offset().top
                        }, 100, "linear", function () {
                            // when done, add hash to url
                            // (default click behaviour)
                            window.location.hash = hash;
                        });
                    });
                }
            }
        }

        smoothHashScroll();
        var toc = $('.ui-toc');
        var tocAffix = $('.ui-affix-toc');
        var tocDropdown = $('.ui-toc-dropdown');
        //toc
        tocDropdown.click(function (e) {
            e.stopPropagation();
        });

        var enoughForAffixToc = true;

        function generateScrollspy() {
            $(document.body).scrollspy({
                target: ''
            });
            $(document.body).scrollspy('refresh');
            if (enoughForAffixToc) {
                toc.hide();
                tocAffix.show();
            } else {
                tocAffix.hide();
                toc.show();
            }
            $(document.body).scroll();
        }

        function windowResize() {
            //toc right
            var paddingRight = parseFloat(markdown.css('padding-right'));
            var right = ($(window).width() - (markdown.offset().left + markdown.outerWidth() - paddingRight));
            toc.css('right', right + 'px');
            //affix toc left
            var newbool;
            var rightMargin = (markdown.parent().outerWidth() - markdown.outerWidth()) / 2;
            //for ipad or wider device
            if (rightMargin >= 133) {
                newbool = true;
                var affixLeftMargin = (tocAffix.outerWidth() - tocAffix.width()) / 2;
                var left = markdown.offset().left + markdown.outerWidth() - affixLeftMargin;
                tocAffix.css('left', left + 'px');
            } else {
                newbool = false;
            }
            if (newbool != enoughForAffixToc) {
                enoughForAffixToc = newbool;
                generateScrollspy();
            }
        }
        $(window).resize(function () {
            windowResize();
        });
        $(document).ready(function () {
            windowResize();
            generateScrollspy();
        });

        //remove hash
        function removeHash() {
            window.location.hash = '';
        }

        var backtotop = $('.back-to-top');
        var gotobottom = $('.go-to-bottom');

        backtotop.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToTop)
                scrollToTop();
            removeHash();
        });
        gotobottom.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToBottom)
                scrollToBottom();
            removeHash();
        });

        var toggle = $('.expand-toggle');
        var tocExpand = false;

        checkExpandToggle();
        toggle.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            tocExpand = !tocExpand;
            checkExpandToggle();
        })

        function checkExpandToggle () {
            var toc = $('.ui-toc-dropdown .toc');
            var toggle = $('.expand-toggle');
            if (!tocExpand) {
                toc.removeClass('expand');
                toggle.text('Expand all');
            } else {
                toc.addClass('expand');
                toggle.text('Collapse all');
            }
        }

        function scrollToTop() {
            $('body, html').stop(true, true).animate({
                scrollTop: 0
            }, 100, "linear");
        }

        function scrollToBottom() {
            $('body, html').stop(true, true).animate({
                scrollTop: $(document.body)[0].scrollHeight
            }, 100, "linear");
        }
    </script>
</body>

</html>
