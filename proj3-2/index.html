<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <title>
        CS 184 Project 3-2 Writeup - HackMD
    </title>
    <link rel="icon" type="image/png" href="https://hackmd.io/favicon.png">
    <link rel="apple-touch-icon" href="https://hackmd.io/apple-touch-icon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css" integrity="sha256-3iu9jgsy9TpTwXKb7bNQzqWekRX7pPK+2OLj3R922fo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/octicons/3.5.0/octicons.min.css" integrity="sha256-QiWfLIsCT02Sdwkogf6YMiQlj4NE84MKkzEMkZnMGdg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/themes/prism.min.css" integrity="sha256-vtR0hSWRc3Tb26iuN2oZHt3KRUomwTufNIf5/4oeCyg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/css/basic/emojify.min.css" integrity="sha256-UOrvMOsSDSrW6szVLe8ZDZezBxh5IoIfgTwdNDgTjiU=" crossorigin="anonymous" />
    <style>
        @import url(https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i|Source+Code+Pro:300,400,500|Source+Sans+Pro:300,300i,400,400i,600,600i|Source+Serif+Pro&subset=latin-ext);.hljs{background:#fff;color:#333;display:block;overflow-x:auto;padding:.5em}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-string,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#a71d5d}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#0086b3}.hljs-built_in,.hljs-builtin-name{color:#005cc5}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#795da3}.hljs-addition{background-color:#eaffea;color:#55a532}.hljs-deletion{background-color:#ffecec;color:#bd2c00}.hljs-link{text-decoration:underline}.markdown-body{word-wrap:break-word;font-size:16px;line-height:1.5}.markdown-body:after,.markdown-body:before{content:"";display:table}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .absent{color:#c00}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-bottom:16px;margin-top:0}.markdown-body hr{background-color:#e7e7e7;border:0;height:.25em;margin:24px 0;padding:0}.markdown-body blockquote{border-left:.25em solid #ddd;color:#777;font-size:16px;padding:0 1em}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body kbd,.popover kbd{background-color:#fcfcfc;border:1px solid;border-color:#ccc #ccc #bbb;border-radius:3px;box-shadow:inset 0 -1px 0 #bbb;color:#555;display:inline-block;font-size:11px;line-height:10px;padding:3px 5px;vertical-align:middle}.markdown-body .loweralpha{list-style-type:lower-alpha}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:600;line-height:1.25;margin-bottom:16px;margin-top:24px}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#000;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1 code,.markdown-body h1 tt,.markdown-body h2 code,.markdown-body h2 tt,.markdown-body h3 code,.markdown-body h3 tt,.markdown-body h4 code,.markdown-body h4 tt,.markdown-body h5 code,.markdown-body h5 tt,.markdown-body h6 code,.markdown-body h6 tt{font-size:inherit}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{border-bottom:1px solid #eee;padding-bottom:.3em}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{color:#777;font-size:.85em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol.no-list,.markdown-body ul.no-list{list-style-type:none;padding:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-bottom:0;margin-top:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{padding-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{font-size:1em;font-style:italic;font-weight:700;margin-top:16px;padding:0}.markdown-body dl dd{margin-bottom:16px;padding:0 16px}.markdown-body table{display:block;overflow:auto;width:100%;word-break:normal;word-break:keep-all}.markdown-body table th{font-weight:700}.markdown-body table td,.markdown-body table th{border:1px solid #ddd;padding:6px 13px}.markdown-body table tr{background-color:#fff;border-top:1px solid #ccc}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{background-color:#fff;box-sizing:initial;max-width:100%}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body .emoji{background-color:initial;max-width:none;vertical-align:text-top}.markdown-body span.frame{display:block;overflow:hidden}.markdown-body span.frame>span{border:1px solid #ddd;display:block;float:left;margin:13px 0 0;overflow:hidden;padding:7px;width:auto}.markdown-body span.frame span img{display:block;float:left}.markdown-body span.frame span span{clear:both;color:#333;display:block;padding:5px 0 0}.markdown-body span.align-center{clear:both;display:block;overflow:hidden}.markdown-body span.align-center>span{display:block;margin:13px auto 0;overflow:hidden;text-align:center}.markdown-body span.align-center span img{margin:0 auto;text-align:center}.markdown-body span.align-right{clear:both;display:block;overflow:hidden}.markdown-body span.align-right>span{display:block;margin:13px 0 0;overflow:hidden;text-align:right}.markdown-body span.align-right span img{margin:0;text-align:right}.markdown-body span.float-left{display:block;float:left;margin-right:13px;overflow:hidden}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{display:block;float:right;margin-left:13px;overflow:hidden}.markdown-body span.float-right>span{display:block;margin:13px auto 0;overflow:hidden;text-align:right}.markdown-body code,.markdown-body tt{background-color:#0000000a;border-radius:3px;font-size:85%;margin:0;padding:.2em 0}.markdown-body code:after,.markdown-body code:before,.markdown-body tt:after,.markdown-body tt:before{content:"\00a0";letter-spacing:-.2em}.markdown-body code br,.markdown-body tt br{display:none}.markdown-body del code{text-decoration:inherit}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{background:#0000;border:0;font-size:100%;margin:0;padding:0;white-space:pre;word-break:normal}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{background-color:#f7f7f7;border-radius:3px;font-size:85%;line-height:1.45;overflow:auto;padding:16px}.markdown-body pre code,.markdown-body pre tt{word-wrap:normal;background-color:initial;border:0;display:inline;line-height:inherit;margin:0;max-width:auto;overflow:visible;padding:0}.markdown-body pre code:after,.markdown-body pre code:before,.markdown-body pre tt:after,.markdown-body pre tt:before{content:normal}.markdown-body .csv-data td,.markdown-body .csv-data th{font-size:12px;line-height:1;overflow:hidden;padding:5px;text-align:left;white-space:nowrap}.markdown-body .csv-data .blob-line-num{background:#fff;border:0;padding:10px 8px 9px;text-align:right}.markdown-body .csv-data tr{border-top:0}.markdown-body .csv-data th{background:#f8f8f8;border-top:0;font-weight:700}.news .alert .markdown-body blockquote{border:0;padding:0 0 0 40px}.activity-tab .news .alert .commits,.activity-tab .news .markdown-body blockquote{padding-left:0}.task-list-item{list-style-type:none}.task-list-item label{font-weight:400}.task-list-item.enabled label{cursor:pointer}.task-list-item+.task-list-item{margin-top:3px}.task-list-item-checkbox{cursor:default!important;float:left;margin:.31em 0 .2em -1.3em!important;vertical-align:middle}.markdown-body{max-width:758px;overflow:visible!important;padding-bottom:40px;padding-top:40px;position:relative}.markdown-body .emoji{vertical-align:top}.markdown-body pre{border:inherit!important}.markdown-body code{color:inherit!important}.markdown-body pre code .wrapper{display:-moz-inline-flex;display:-ms-inline-flex;display:-o-inline-flex;display:inline-flex}.markdown-body pre code .gutter{float:left;overflow:hidden;-webkit-user-select:none;user-select:none}.markdown-body pre code .gutter.linenumber{border-right:3px solid #6ce26c!important;box-sizing:initial;color:#afafaf!important;cursor:default;display:inline-block;min-width:20px;padding:0 8px 0 0;position:relative;text-align:right;z-index:4}.markdown-body pre code .gutter.linenumber>span:before{content:attr(data-linenumber)}.markdown-body pre code .code{float:left;margin:0 0 0 16px}.markdown-body .gist .line-numbers{border-bottom:none;border-left:none;border-top:none}.markdown-body .gist .line-data{border:none}.markdown-body .gist table{border-collapse:inherit!important;border-spacing:0}.markdown-body code[data-gist-id]{background:none;padding:0}.markdown-body code[data-gist-id]:after,.markdown-body code[data-gist-id]:before{content:""}.markdown-body code[data-gist-id] .blob-num{border:unset}.markdown-body code[data-gist-id] table{margin-bottom:unset;overflow:unset}.markdown-body code[data-gist-id] table tr{background:unset}.markdown-body[dir=rtl] pre{direction:ltr}.markdown-body[dir=rtl] code{direction:ltr;unicode-bidi:embed}.markdown-body .alert>p:last-child{margin-bottom:0}.markdown-body pre.abc,.markdown-body pre.flow-chart,.markdown-body pre.graphviz,.markdown-body pre.mermaid,.markdown-body pre.sequence-diagram,.markdown-body pre.vega{background-color:inherit;border-radius:0;overflow:visible;text-align:center;white-space:inherit}.markdown-body pre.abc>code,.markdown-body pre.flow-chart>code,.markdown-body pre.graphviz>code,.markdown-body pre.mermaid>code,.markdown-body pre.sequence-diagram>code,.markdown-body pre.vega>code{text-align:left}.markdown-body pre.abc>svg,.markdown-body pre.flow-chart>svg,.markdown-body pre.graphviz>svg,.markdown-body pre.mermaid>svg,.markdown-body pre.sequence-diagram>svg,.markdown-body pre.vega>svg{height:100%;max-width:100%}.markdown-body pre>code.wrap{word-wrap:break-word;white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap}.markdown-body .alert>p:last-child,.markdown-body .alert>ul:last-child{margin-bottom:0}.markdown-body summary{display:list-item}.markdown-body summary:focus{outline:none}.markdown-body details summary{cursor:pointer}.markdown-body details:not([open])>:not(summary){display:none}.markdown-body figure{margin:1em 40px}.markdown-body .mark,.markdown-body mark{background-color:#fff1a7}.vimeo,.youtube{background-color:#000;background-position:50%;background-repeat:no-repeat;background-size:contain;cursor:pointer;display:table;overflow:hidden;text-align:center}.vimeo,.youtube{position:relative;width:100%}.youtube{padding-bottom:56.25%}.vimeo img{object-fit:contain;width:100%;z-index:0}.youtube img{object-fit:cover;z-index:0}.vimeo iframe,.youtube iframe,.youtube img{height:100%;left:0;position:absolute;top:0;width:100%}.vimeo iframe,.youtube iframe{vertical-align:middle;z-index:1}.vimeo .icon,.youtube .icon{color:#fff;height:auto;left:50%;opacity:.3;position:absolute;top:50%;transform:translate(-50%,-50%);transition:opacity .2s;width:auto;z-index:0}.vimeo:hover .icon,.youtube:hover .icon{opacity:.6;transition:opacity .2s}.slideshare .inner,.speakerdeck .inner{position:relative;width:100%}.slideshare .inner iframe,.speakerdeck .inner iframe{bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:100%}.figma{display:table;padding-bottom:56.25%;position:relative;width:100%}.figma iframe{border:1px solid #eee;bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:100%}.markmap-container{height:300px}.markmap-container>svg{height:100%;width:100%}.MJX_Assistive_MathML{display:none}#MathJax_Message{z-index:1000!important}.ui-infobar{color:#777;margin:25px auto -25px;max-width:760px;position:relative;z-index:2}.toc .invisable-node{list-style-type:none}.ui-toc{bottom:20px;position:fixed;z-index:998}.ui-toc.both-mode{margin-left:8px}.ui-toc.both-mode .ui-toc-label{border-bottom-left-radius:0;border-top-left-radius:0;height:40px;padding:10px 4px}.ui-toc-label{background-color:#e6e6e6;border:none;color:#868686;transition:opacity .2s}.ui-toc .open .ui-toc-label{color:#fff;opacity:1;transition:opacity .2s}.ui-toc-label:focus{background-color:#ccc;color:#000;opacity:.3}.ui-toc-label:hover{background-color:#ccc;opacity:1;transition:opacity .2s}.ui-toc-dropdown{margin-bottom:20px;margin-top:20px;max-height:70vh;max-width:45vw;overflow:auto;padding-left:10px;padding-right:10px;text-align:inherit;width:25vw}.ui-toc-dropdown>.toc{max-height:calc(70vh - 100px);overflow:auto}.ui-toc-dropdown[dir=rtl] .nav{letter-spacing:.0029em;padding-right:0}.ui-toc-dropdown a{overflow:hidden;text-overflow:ellipsis;white-space:pre}.ui-toc-dropdown .nav>li>a{color:#767676;display:block;font-size:13px;font-weight:500;padding:4px 20px}.ui-toc-dropdown .nav>li:first-child:last-child>ul,.ui-toc-dropdown .toc.expand ul{display:block}.ui-toc-dropdown .nav>li>a:focus,.ui-toc-dropdown .nav>li>a:hover{background-color:initial;border-left:1px solid #000;color:#000;padding-left:19px;text-decoration:none}.ui-toc-dropdown[dir=rtl] .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav>li>a:hover{border-left:none;border-right:1px solid #000;padding-right:19px}.ui-toc-dropdown .nav>.active:focus>a,.ui-toc-dropdown .nav>.active:hover>a,.ui-toc-dropdown .nav>.active>a{background-color:initial;border-left:2px solid #000;color:#000;font-weight:700;padding-left:18px}.ui-toc-dropdown[dir=rtl] .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav>.active>a{border-left:none;border-right:2px solid #000;padding-right:18px}.ui-toc-dropdown .nav .nav{display:none;padding-bottom:10px}.ui-toc-dropdown .nav>.active>ul{display:block}.ui-toc-dropdown .nav .nav>li>a{font-size:12px;font-weight:400;padding-bottom:1px;padding-left:30px;padding-top:1px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a{padding-right:30px}.ui-toc-dropdown .nav .nav>li>ul>li>a{font-size:12px;font-weight:400;padding-bottom:1px;padding-left:40px;padding-top:1px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a{padding-right:40px}.ui-toc-dropdown .nav .nav>li>a:focus,.ui-toc-dropdown .nav .nav>li>a:hover{padding-left:29px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:hover{padding-right:29px}.ui-toc-dropdown .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown .nav .nav>li>ul>li>a:hover{padding-left:39px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:hover{padding-right:39px}.ui-toc-dropdown .nav .nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>a{font-weight:500;padding-left:28px}.ui-toc-dropdown[dir=rtl] .nav .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>a{padding-right:28px}.ui-toc-dropdown .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>a{font-weight:500;padding-left:38px}.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>a{padding-right:38px}.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang^=ja] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang=zh-tw] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang=zh-cn] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html .markdown-body[lang^=ja]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html .markdown-body[lang=zh-tw]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html .markdown-body[lang=zh-cn]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang^=ja] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ Ｐゴシック,sans-serif}html[lang=zh-tw] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html[lang=zh-cn] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}html .ui-toc-dropdown[lang^=ja]{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ Ｐゴシック,sans-serif}html .ui-toc-dropdown[lang=zh-tw]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html .ui-toc-dropdown[lang=zh-cn]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}.ui-affix-toc{max-height:70vh;max-width:15vw;overflow:auto;position:fixed;top:0}.back-to-top,.expand-toggle,.go-to-bottom{color:#999;display:block;font-size:12px;font-weight:500;margin-left:10px;margin-top:10px;padding:4px 10px}.back-to-top:focus,.back-to-top:hover,.expand-toggle:focus,.expand-toggle:hover,.go-to-bottom:focus,.go-to-bottom:hover{color:#563d7c;text-decoration:none}.back-to-top,.go-to-bottom{margin-top:0}.ui-user-icon{background-position:50%;background-repeat:no-repeat;background-size:cover;border-radius:50%;display:block;height:20px;margin-bottom:2px;margin-right:5px;margin-top:2px;width:20px}.ui-user-icon.small{display:inline-block;height:18px;margin:0 0 .2em;vertical-align:middle;width:18px}.ui-infobar>small>span{line-height:22px}.ui-infobar>small .dropdown{display:inline-block}.ui-infobar>small .dropdown a:focus,.ui-infobar>small .dropdown a:hover{text-decoration:none}.ui-more-info{color:#888;cursor:pointer;vertical-align:middle}.ui-more-info .fa{font-size:16px}.ui-connectedGithub,.ui-published-note{color:#888}.ui-connectedGithub{line-height:23px;white-space:nowrap}.ui-connectedGithub a.file-path{color:#888;padding-left:22px;text-decoration:none}.ui-connectedGithub a.file-path:active,.ui-connectedGithub a.file-path:hover{color:#888;text-decoration:underline}.ui-connectedGithub .fa{font-size:20px}.ui-published-note .fa{font-size:20px;vertical-align:top}.unselectable{-webkit-user-select:none;-o-user-select:none;user-select:none}.selectable{-webkit-user-select:text;-o-user-select:text;user-select:text}.inline-spoiler-section{cursor:pointer}.inline-spoiler-section .spoiler-text{background-color:#333;border-radius:2px}.inline-spoiler-section .spoiler-text>*{opacity:0}.inline-spoiler-section .spoiler-img{filter:blur(10px)}.inline-spoiler-section.raw{background-color:#333;border-radius:2px}.inline-spoiler-section.raw>*{opacity:0}.inline-spoiler-section.unveil{cursor:auto}.inline-spoiler-section.unveil .spoiler-text{background-color:#3333331a}.inline-spoiler-section.unveil .spoiler-text>*{opacity:1}.inline-spoiler-section.unveil .spoiler-img{filter:none}@media print{blockquote,div,img,pre,table{page-break-inside:avoid!important}a[href]:after{font-size:12px!important}}.markdown-body.slides{color:#222;position:relative;z-index:1}.markdown-body.slides:before{background-color:currentColor;bottom:0;box-shadow:0 0 0 50vw;content:"";display:block;left:0;position:absolute;right:0;top:0;z-index:-1}.markdown-body.slides section[data-markdown]{background-color:#fff;margin-bottom:1.5em;position:relative;text-align:center}.markdown-body.slides section[data-markdown] code{text-align:left}.markdown-body.slides section[data-markdown]:before{content:"";display:block;padding-bottom:56.23%}.markdown-body.slides section[data-markdown]>div:first-child{left:1em;max-height:100%;overflow:hidden;position:absolute;right:1em;top:50%;transform:translateY(-50%)}.markdown-body.slides section[data-markdown]>ul{display:inline-block}.markdown-body.slides>section>section+section:after{border:3px solid #777;content:"";height:1.5em;position:absolute;right:1em;top:-1.5em}.site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,sans-serif}html[lang^=ja] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif}html[lang=zh-tw] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}body{font-smoothing:subpixel-antialiased!important;-webkit-font-smoothing:subpixel-antialiased!important;-moz-osx-font-smoothing:auto!important;-webkit-overflow-scrolling:touch;font-family:Source Sans Pro,Helvetica,Arial,sans-serif;letter-spacing:.025em}html[lang^=ja] body{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif}html[lang=zh-tw] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}abbr[data-original-title],abbr[title]{cursor:help}body.modal-open{overflow-y:auto;padding-right:0!important}svg{text-shadow:none}
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
    <![endif]-->
</head>

<body>
    <div id="doc" class="markdown-body container-fluid comment-enabled" data-hard-breaks="true"><h1 id="CS-184-Project-3-2-Writeup" data-id="CS-184-Project-3-2-Writeup"><a class="anchor hidden-xs" href="#CS-184-Project-3-2-Writeup" title="CS-184-Project-3-2-Writeup"><span class="octicon octicon-link"></span></a><span>CS 184 Project 3-2 Writeup</span></h1><p><span>Tianchen Liu 3034681144, Riley Peterlinz 3036754368</span></p><p><span>Link:</span><br>
<a href="https://cal-cs184-student.github.io/project-webpages-sp23-CardiacMangoes/proj3-2/index.html" target="_blank" rel="noopener"><span>https://cal-cs184-student.github.io/project-webpages-sp23-CardiacMangoes/proj3-2/index.html</span></a></p><h2 id="Overview" data-id="Overview"><a class="anchor hidden-xs" href="#Overview" title="Overview"><span class="octicon octicon-link"></span></a><span>Overview</span></h2><p><span>Parts completed: 1 &amp; 4</span></p><p><span>Part 1: We implemented a glossy BSDF, refractive BSDF, and then combined them to make a glass BSDF. We used first principles of material and didn’t run into any major issues.</span></p><p><span>Part 4: We adjusted where our “camera” samples pixels in order to simulate focus using the principles of a thin lens. We followed the diagram in the spec and reasoned geometrically. The only issue was we forgot to shift coordinates initially.</span></p><h2 id="Part-1" data-id="Part-1"><a class="anchor hidden-xs" href="#Part-1" title="Part-1"><span class="octicon octicon-link"></span></a><span>Part 1</span></h2><h3 id="Implementation" data-id="Implementation"><a class="anchor hidden-xs" href="#Implementation" title="Implementation"><span class="octicon octicon-link"></span></a><span>Implementation</span></h3><h4 id="Reflection" data-id="Reflection"><a class="anchor hidden-xs" href="#Reflection" title="Reflection"><span class="octicon octicon-link"></span></a><span>Reflection</span></h4><p><span>We want to reflect a ray </span><span class="mathjax"><span class="MathJax_Preview" style="color: inherit;"></span><span id="MathJax-Element-262-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mover><mi>r</mi><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></mover></mrow><mo>=</mo><mrow><mo>[</mo><mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;><mtr><mtd><mi>x</mi></mtd></mtr><mtr><mtd><mi>y</mi></mtd></mtr><mtr><mtd><mi>z</mi></mtd></mtr></mtable><mo>]</mo></mrow></math>" role="presentation" style="font-size: 119%; position: relative;"><span id="MJXc-Node-4901" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-4902" class="mjx-mrow"><span id="MJXc-Node-4903" class="mjx-texatom"><span id="MJXc-Node-4904" class="mjx-mrow"><span id="MJXc-Node-4905" class="mjx-munderover"><span class="mjx-stack"><span class="mjx-over" style="height: 0.248em; padding-bottom: 0.06em; padding-left: 0.031em;"><span id="MJXc-Node-4907" class="mjx-mo" style="vertical-align: top;"><span class="mjx-char MJXc-TeX-vec-R" style="padding-top: 0.475em; padding-bottom: 0.265em;">→</span></span></span><span class="mjx-op"><span id="MJXc-Node-4906" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.213em; padding-bottom: 0.265em;">r</span></span></span></span></span></span></span><span id="MJXc-Node-4908" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.055em; padding-bottom: 0.318em;">=</span></span><span id="MJXc-Node-4909" class="mjx-mrow MJXc-space3"><span id="MJXc-Node-4910" class="mjx-mo" style="vertical-align: -0.996em;"><span class="mjx-delim-v"><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.948em; padding-bottom: 0.948em;">⎡</span><span class="mjx-char MJXc-TeX-size4-R" style="line-height: 0.232em; margin-bottom: -0.101em; margin-top: 0px;">⎢</span><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.948em; padding-bottom: 0.895em;">⎣</span></span></span><span id="MJXc-Node-4911" class="mjx-mtable" style="vertical-align: -1.665em; padding: 0px 0.167em;"><span class="mjx-table"><span id="MJXc-Node-4912" class="mjx-mtr" style="height: 1.2em;"><span id="MJXc-Node-4913" class="mjx-mtd" style="padding: 0px; width: 0.572em;"><span id="MJXc-Node-4914" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-4915" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.213em; padding-bottom: 0.265em;">x</span></span><span class="mjx-strut"></span></span></span></span><span id="MJXc-Node-4916" class="mjx-mtr" style="height: 1.43em;"><span id="MJXc-Node-4917" class="mjx-mtd" style="padding: 0.2em 0px 0px;"><span id="MJXc-Node-4918" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-4919" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.213em; padding-bottom: 0.475em; padding-right: 0.006em;">y</span></span><span class="mjx-strut"></span></span></span></span><span id="MJXc-Node-4920" class="mjx-mtr" style="height: 1.2em;"><span id="MJXc-Node-4921" class="mjx-mtd" style="padding: 0.2em 0px 0px;"><span id="MJXc-Node-4922" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-4923" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.213em; padding-bottom: 0.265em; padding-right: 0.003em;">z</span></span><span class="mjx-strut"></span></span></span></span></span></span><span id="MJXc-Node-4924" class="mjx-mo" style="vertical-align: -0.996em;"><span class="mjx-delim-v"><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.948em; padding-bottom: 0.948em;">⎤</span><span class="mjx-char MJXc-TeX-size4-R" style="line-height: 0.232em; margin-bottom: -0.101em; margin-top: 0px;">⎥</span><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.948em; padding-bottom: 0.895em;">⎦</span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mover><mi>r</mi><mo stretchy="false">→</mo></mover></mrow><mo>=</mo><mrow><mo>[</mo><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><mi>x</mi></mtd></mtr><mtr><mtd><mi>y</mi></mtd></mtr><mtr><mtd><mi>z</mi></mtd></mtr></mtable><mo>]</mo></mrow></math></span></span><script type="math/tex" id="MathJax-Element-262">\vec{r} = \begin{bmatrix} x \\ y \\ z \end{bmatrix}</script></span><span>  about the normal </span><span class="mathjax"><span class="MathJax_Preview" style="color: inherit;"></span><span id="MathJax-Element-263-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mover><mi>z</mi><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></mover></mrow><mo>=</mo><mrow><mo>[</mo><mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>1</mn></mtd></mtr></mtable><mo>]</mo></mrow></math>" role="presentation" style="font-size: 119%; position: relative;"><span id="MJXc-Node-4925" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-4926" class="mjx-mrow"><span id="MJXc-Node-4927" class="mjx-texatom"><span id="MJXc-Node-4928" class="mjx-mrow"><span id="MJXc-Node-4929" class="mjx-munderover"><span class="mjx-stack"><span class="mjx-over" style="height: 0.248em; padding-bottom: 0.06em; padding-left: 0.067em;"><span id="MJXc-Node-4931" class="mjx-mo" style="vertical-align: top;"><span class="mjx-char MJXc-TeX-vec-R" style="padding-top: 0.475em; padding-bottom: 0.265em;">→</span></span></span><span class="mjx-op"><span id="MJXc-Node-4930" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.213em; padding-bottom: 0.265em; padding-right: 0.003em;">z</span></span></span></span></span></span></span><span id="MJXc-Node-4932" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.055em; padding-bottom: 0.318em;">=</span></span><span id="MJXc-Node-4933" class="mjx-mrow MJXc-space3"><span id="MJXc-Node-4934" class="mjx-mo" style="vertical-align: -0.981em;"><span class="mjx-delim-v"><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.948em; padding-bottom: 0.948em;">⎡</span><span class="mjx-char MJXc-TeX-size4-R" style="line-height: 0.202em; margin-bottom: -0.101em; margin-top: 0px;">⎢</span><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.948em; padding-bottom: 0.895em;">⎣</span></span></span><span id="MJXc-Node-4935" class="mjx-mtable" style="vertical-align: -1.65em; padding: 0px 0.167em;"><span class="mjx-table"><span id="MJXc-Node-4936" class="mjx-mtr" style="height: 1.2em;"><span id="MJXc-Node-4937" class="mjx-mtd" style="padding: 0px; width: 0.5em;"><span id="MJXc-Node-4938" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-4939" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.37em;">0</span></span><span class="mjx-strut"></span></span></span></span><span id="MJXc-Node-4940" class="mjx-mtr" style="height: 1.4em;"><span id="MJXc-Node-4941" class="mjx-mtd" style="padding: 0.2em 0px 0px;"><span id="MJXc-Node-4942" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-4943" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.37em;">0</span></span><span class="mjx-strut"></span></span></span></span><span id="MJXc-Node-4944" class="mjx-mtr" style="height: 1.2em;"><span id="MJXc-Node-4945" class="mjx-mtd" style="padding: 0.2em 0px 0px;"><span id="MJXc-Node-4946" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-4947" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.318em;">1</span></span><span class="mjx-strut"></span></span></span></span></span></span><span id="MJXc-Node-4948" class="mjx-mo" style="vertical-align: -0.981em;"><span class="mjx-delim-v"><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.948em; padding-bottom: 0.948em;">⎤</span><span class="mjx-char MJXc-TeX-size4-R" style="line-height: 0.202em; margin-bottom: -0.101em; margin-top: 0px;">⎥</span><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.948em; padding-bottom: 0.895em;">⎦</span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mover><mi>z</mi><mo stretchy="false">→</mo></mover></mrow><mo>=</mo><mrow><mo>[</mo><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>1</mn></mtd></mtr></mtable><mo>]</mo></mrow></math></span></span><script type="math/tex" id="MathJax-Element-263">\vec{z} = \begin{bmatrix} 0 \\ 0 \\ 1 \end{bmatrix}</script></span></p><p><span>We can do this with a reflection matrix constructed as</span><br>
<img src="https://i.imgur.com/qjqtlkl.png" alt="" loading="lazy"></p><p><span>Which makes</span><br>
<span class="mathjax"><span class="MathJax_Preview" style="color: inherit;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-264-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mrow><mo>[</mo><mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;><mtr><mtd><mo>&amp;#x2212;</mo><mn>1</mn></mtd><mtd><mn>0</mn></mtd><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd><mtd><mo>&amp;#x2212;</mo><mn>1</mn></mtd><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd><mtd><mn>0</mn></mtd><mtd><mn>1</mn></mtd></mtr></mtable><mo>]</mo></mrow><mrow><mo>[</mo><mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;><mtr><mtd><mi>x</mi></mtd></mtr><mtr><mtd><mi>y</mi></mtd></mtr><mtr><mtd><mi>z</mi></mtd></mtr></mtable><mo>]</mo></mrow><mo>=</mo><mrow><mo>[</mo><mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;><mtr><mtd><mo>&amp;#x2212;</mo><mi>x</mi></mtd></mtr><mtr><mtd><mo>&amp;#x2212;</mo><mi>y</mi></mtd></mtr><mtr><mtd><mi>z</mi></mtd></mtr></mtable><mo>]</mo></mrow></math>" role="presentation" style="font-size: 119%; text-align: center; position: relative;"><span id="MJXc-Node-4949" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-4950" class="mjx-mrow"><span id="MJXc-Node-4951" class="mjx-mrow"><span id="MJXc-Node-4952" class="mjx-mo" style="vertical-align: -0.981em;"><span class="mjx-delim-v"><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.948em; padding-bottom: 0.948em;">⎡</span><span class="mjx-char MJXc-TeX-size4-R" style="line-height: 0.202em; margin-bottom: -0.101em; margin-top: 0px;">⎢</span><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.948em; padding-bottom: 0.895em;">⎣</span></span></span><span id="MJXc-Node-4953" class="mjx-mtable" style="vertical-align: -1.65em; padding: 0px 0.167em;"><span class="mjx-table"><span id="MJXc-Node-4954" class="mjx-mtr" style="height: 1.2em;"><span id="MJXc-Node-4955" class="mjx-mtd" style="padding: 0px 0.5em 0px 0px; width: 1.278em;"><span id="MJXc-Node-4956" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-4957" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.318em; padding-bottom: 0.423em;">−</span></span><span id="MJXc-Node-4958" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.318em;">1</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-4959" class="mjx-mtd" style="padding: 0px 0.5em; width: 1.278em;"><span id="MJXc-Node-4960" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-4961" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.37em;">0</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-4962" class="mjx-mtd" style="padding: 0px 0px 0px 0.5em; width: 0.5em;"><span id="MJXc-Node-4963" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-4964" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.37em;">0</span></span><span class="mjx-strut"></span></span></span></span><span id="MJXc-Node-4965" class="mjx-mtr" style="height: 1.4em;"><span id="MJXc-Node-4966" class="mjx-mtd" style="padding: 0.2em 0.5em 0px 0px;"><span id="MJXc-Node-4967" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-4968" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.37em;">0</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-4969" class="mjx-mtd" style="padding: 0.2em 0.5em 0px;"><span id="MJXc-Node-4970" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-4971" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.318em; padding-bottom: 0.423em;">−</span></span><span id="MJXc-Node-4972" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.318em;">1</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-4973" class="mjx-mtd" style="padding: 0.2em 0px 0px 0.5em;"><span id="MJXc-Node-4974" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-4975" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.37em;">0</span></span><span class="mjx-strut"></span></span></span></span><span id="MJXc-Node-4976" class="mjx-mtr" style="height: 1.2em;"><span id="MJXc-Node-4977" class="mjx-mtd" style="padding: 0.2em 0.5em 0px 0px;"><span id="MJXc-Node-4978" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-4979" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.37em;">0</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-4980" class="mjx-mtd" style="padding: 0.2em 0.5em 0px;"><span id="MJXc-Node-4981" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-4982" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.37em;">0</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-4983" class="mjx-mtd" style="padding: 0.2em 0px 0px 0.5em;"><span id="MJXc-Node-4984" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-4985" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.318em;">1</span></span><span class="mjx-strut"></span></span></span></span></span></span><span id="MJXc-Node-4986" class="mjx-mo" style="vertical-align: -0.981em;"><span class="mjx-delim-v"><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.948em; padding-bottom: 0.948em;">⎤</span><span class="mjx-char MJXc-TeX-size4-R" style="line-height: 0.202em; margin-bottom: -0.101em; margin-top: 0px;">⎥</span><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.948em; padding-bottom: 0.895em;">⎦</span></span></span></span><span id="MJXc-Node-4987" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-4988" class="mjx-mo" style="vertical-align: -0.996em;"><span class="mjx-delim-v"><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.948em; padding-bottom: 0.948em;">⎡</span><span class="mjx-char MJXc-TeX-size4-R" style="line-height: 0.232em; margin-bottom: -0.101em; margin-top: 0px;">⎢</span><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.948em; padding-bottom: 0.895em;">⎣</span></span></span><span id="MJXc-Node-4989" class="mjx-mtable" style="vertical-align: -1.665em; padding: 0px 0.167em;"><span class="mjx-table"><span id="MJXc-Node-4990" class="mjx-mtr" style="height: 1.2em;"><span id="MJXc-Node-4991" class="mjx-mtd" style="padding: 0px; width: 0.572em;"><span id="MJXc-Node-4992" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-4993" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.213em; padding-bottom: 0.265em;">x</span></span><span class="mjx-strut"></span></span></span></span><span id="MJXc-Node-4994" class="mjx-mtr" style="height: 1.43em;"><span id="MJXc-Node-4995" class="mjx-mtd" style="padding: 0.2em 0px 0px;"><span id="MJXc-Node-4996" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-4997" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.213em; padding-bottom: 0.475em; padding-right: 0.006em;">y</span></span><span class="mjx-strut"></span></span></span></span><span id="MJXc-Node-4998" class="mjx-mtr" style="height: 1.2em;"><span id="MJXc-Node-4999" class="mjx-mtd" style="padding: 0.2em 0px 0px;"><span id="MJXc-Node-5000" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-5001" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.213em; padding-bottom: 0.265em; padding-right: 0.003em;">z</span></span><span class="mjx-strut"></span></span></span></span></span></span><span id="MJXc-Node-5002" class="mjx-mo" style="vertical-align: -0.996em;"><span class="mjx-delim-v"><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.948em; padding-bottom: 0.948em;">⎤</span><span class="mjx-char MJXc-TeX-size4-R" style="line-height: 0.232em; margin-bottom: -0.101em; margin-top: 0px;">⎥</span><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.948em; padding-bottom: 0.895em;">⎦</span></span></span></span><span id="MJXc-Node-5003" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.055em; padding-bottom: 0.318em;">=</span></span><span id="MJXc-Node-5004" class="mjx-mrow MJXc-space3"><span id="MJXc-Node-5005" class="mjx-mo" style="vertical-align: -0.996em;"><span class="mjx-delim-v"><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.948em; padding-bottom: 0.948em;">⎡</span><span class="mjx-char MJXc-TeX-size4-R" style="line-height: 0.232em; margin-bottom: -0.101em; margin-top: 0px;">⎢</span><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.948em; padding-bottom: 0.895em;">⎣</span></span></span><span id="MJXc-Node-5006" class="mjx-mtable" style="vertical-align: -1.665em; padding: 0px 0.167em;"><span class="mjx-table"><span id="MJXc-Node-5007" class="mjx-mtr" style="height: 1.2em;"><span id="MJXc-Node-5008" class="mjx-mtd" style="padding: 0px; width: 1.35em;"><span id="MJXc-Node-5009" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-5010" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.318em; padding-bottom: 0.423em;">−</span></span><span id="MJXc-Node-5011" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.213em; padding-bottom: 0.265em;">x</span></span><span class="mjx-strut"></span></span></span></span><span id="MJXc-Node-5012" class="mjx-mtr" style="height: 1.43em;"><span id="MJXc-Node-5013" class="mjx-mtd" style="padding: 0.2em 0px 0px;"><span id="MJXc-Node-5014" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-5015" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.318em; padding-bottom: 0.423em;">−</span></span><span id="MJXc-Node-5016" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.213em; padding-bottom: 0.475em; padding-right: 0.006em;">y</span></span><span class="mjx-strut"></span></span></span></span><span id="MJXc-Node-5017" class="mjx-mtr" style="height: 1.2em;"><span id="MJXc-Node-5018" class="mjx-mtd" style="padding: 0.2em 0px 0px;"><span id="MJXc-Node-5019" class="mjx-mrow" style="margin-top: -0.2em;"><span id="MJXc-Node-5020" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.213em; padding-bottom: 0.265em; padding-right: 0.003em;">z</span></span><span class="mjx-strut"></span></span></span></span></span></span><span id="MJXc-Node-5021" class="mjx-mo" style="vertical-align: -0.996em;"><span class="mjx-delim-v"><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.948em; padding-bottom: 0.948em;">⎤</span><span class="mjx-char MJXc-TeX-size4-R" style="line-height: 0.232em; margin-bottom: -0.101em; margin-top: 0px;">⎥</span><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.948em; padding-bottom: 0.895em;">⎦</span></span></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mo>[</mo><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><mo>−</mo><mn>1</mn></mtd><mtd><mn>0</mn></mtd><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd><mtd><mo>−</mo><mn>1</mn></mtd><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd><mtd><mn>0</mn></mtd><mtd><mn>1</mn></mtd></mtr></mtable><mo>]</mo></mrow><mrow><mo>[</mo><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><mi>x</mi></mtd></mtr><mtr><mtd><mi>y</mi></mtd></mtr><mtr><mtd><mi>z</mi></mtd></mtr></mtable><mo>]</mo></mrow><mo>=</mo><mrow><mo>[</mo><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><mo>−</mo><mi>x</mi></mtd></mtr><mtr><mtd><mo>−</mo><mi>y</mi></mtd></mtr><mtr><mtd><mi>z</mi></mtd></mtr></mtable><mo>]</mo></mrow></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-264">
\begin{bmatrix} -1 & 0 & 0 \\ 0 & -1 & 0 \\ 0 & 0 & 1 \end{bmatrix}\begin{bmatrix} x \\ y \\ z \end{bmatrix} = \begin{bmatrix} -x \\ -y \\ z \end{bmatrix}
</script></span></p><p><span>So we can just apply this to our </span><code>wo</code><span> to get </span><code>wi</code></p><pre><code class="wrap cpp hljs"><span class="token keyword">void</span> <span class="token class-name">BSDF</span><span class="token double-colon punctuation">::</span><span class="token function">reflect</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3D wo<span class="token punctuation">,</span> Vector3D<span class="token operator">*</span> wi<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">*</span>wi <span class="token operator">=</span> <span class="token function">Vector3D</span><span class="token punctuation">(</span>wo<span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> wo<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> wo<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><p><span>This allows us to reflect </span><code>wo</code><span> and then divide the reflectance by </span><code>abs_cos_theta(*wi)</code><span> to cancel out the cosine term in </span><code>at_least_one_bounce_radiance</code><span>.</span></p><pre><code class="wrap cpp hljs">Vector3D <span class="token class-name">MirrorBSDF</span><span class="token double-colon punctuation">::</span><span class="token function">sample_f</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3D wo<span class="token punctuation">,</span> Vector3D<span class="token operator">*</span> wi<span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> pdf<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">*</span>pdf <span class="token operator">=</span> <span class="token number">1.</span><span class="token punctuation">;</span>
        <span class="token function">reflect</span><span class="token punctuation">(</span>wo<span class="token punctuation">,</span> wi<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> reflectance <span class="token operator">/</span> <span class="token function">abs_cos_theta</span><span class="token punctuation">(</span><span class="token operator">*</span>wi<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><h4 id="Refraction" data-id="Refraction"><a class="anchor hidden-xs" href="#Refraction" title="Refraction"><span class="octicon octicon-link"></span></a><span>Refraction</span></h4><p><span>Refraction is trickier since we have to deal with edge cases.</span></p><p><img src="https://i.imgur.com/kym3vWC.jpg" alt="" loading="lazy"></p><p><span>We first need to decide if a ray is entering or exiting a material. This is important since we are obeying snell’s law</span></p><p><span class="mathjax"><span class="MathJax_Preview" style="color: inherit;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-265-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>sin</mi><mo>&amp;#x2061;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msup><mi>&amp;#x03B8;</mi><mo>&amp;#x2032;</mo></msup></mrow><mo>=</mo><mi>&amp;#x03B7;</mi><mi>sin</mi><mo>&amp;#x2061;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>&amp;#x03B8;</mi></mrow></math>" role="presentation" style="font-size: 119%; text-align: center; position: relative;"><span id="MJXc-Node-5022" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-5023" class="mjx-mrow"><span id="MJXc-Node-5024" class="mjx-mi"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.37em;">sin</span></span><span id="MJXc-Node-5025" class="mjx-mo"><span class="mjx-char"></span></span><span id="MJXc-Node-5026" class="mjx-texatom MJXc-space1"><span id="MJXc-Node-5027" class="mjx-mrow"><span id="MJXc-Node-5028" class="mjx-msup"><span class="mjx-base"><span id="MJXc-Node-5029" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.475em; padding-bottom: 0.265em;">θ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-5030" class="mjx-mo" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.265em; padding-bottom: 0.318em;">′</span></span></span></span></span></span><span id="MJXc-Node-5031" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.055em; padding-bottom: 0.318em;">=</span></span><span id="MJXc-Node-5032" class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.213em; padding-bottom: 0.475em; padding-right: 0.006em;">η</span></span><span id="MJXc-Node-5033" class="mjx-mi MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.37em;">sin</span></span><span id="MJXc-Node-5034" class="mjx-mo"><span class="mjx-char"></span></span><span id="MJXc-Node-5035" class="mjx-texatom MJXc-space1"><span id="MJXc-Node-5036" class="mjx-mrow"><span id="MJXc-Node-5037" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.475em; padding-bottom: 0.265em;">θ</span></span></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>sin</mi><mo>⁡</mo><mrow class="MJX-TeXAtom-ORD"><msup><mi>θ</mi><mo>′</mo></msup></mrow><mo>=</mo><mi>η</mi><mi>sin</mi><mo>⁡</mo><mrow class="MJX-TeXAtom-ORD"><mi>θ</mi></mrow></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-265">\sin{\theta'} = \eta\sin{\theta}</script></span></p><p><span>Where </span><span class="mathjax"><span class="MathJax_Preview" style="color: inherit;"></span><span id="MathJax-Element-266-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>&amp;#x03B8;</mi><mo>&amp;#x2032;</mo></msup></math>" role="presentation" style="font-size: 119%; position: relative;"><span id="MJXc-Node-5038" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-5039" class="mjx-mrow"><span id="MJXc-Node-5040" class="mjx-msup"><span class="mjx-base"><span id="MJXc-Node-5041" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.475em; padding-bottom: 0.265em;">θ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.513em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-5042" class="mjx-mo" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.265em; padding-bottom: 0.318em;">′</span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>θ</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-266">\theta'</script></span><span> is the angle of incidence and </span><span class="mathjax"><span class="MathJax_Preview" style="color: inherit;"></span><span id="MathJax-Element-267-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>&amp;#x03B8;</mi></math>" role="presentation" style="font-size: 119%; position: relative;"><span id="MJXc-Node-5043" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-5044" class="mjx-mrow"><span id="MJXc-Node-5045" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.475em; padding-bottom: 0.265em;">θ</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-267">\theta</script></span><span> is the angle of refraction. We can tell if we are entering or exiting an object if the z-component of </span><code>wo</code><span> is respectively positive or negative.</span></p><p><span>If entering snell’s law becomes</span></p><p><span class="mathjax"><span class="MathJax_Preview" style="color: inherit;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-268-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>ior</mtext><mo>&amp;#x22C5;</mo><mi>sin</mi><mo>&amp;#x2061;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msup><mi>&amp;#x03B8;</mi><mo>&amp;#x2032;</mo></msup></mrow><mo>=</mo><mi>sin</mi><mo>&amp;#x2061;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>&amp;#x03B8;</mi></mrow></math>" role="presentation" style="font-size: 119%; text-align: center; position: relative;"><span id="MJXc-Node-5046" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-5047" class="mjx-mrow"><span id="MJXc-Node-5048" class="mjx-mtext"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.37em;">ior</span></span><span id="MJXc-Node-5049" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.003em; padding-bottom: 0.318em;">⋅</span></span><span id="MJXc-Node-5050" class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.37em;">sin</span></span><span id="MJXc-Node-5051" class="mjx-mo"><span class="mjx-char"></span></span><span id="MJXc-Node-5052" class="mjx-texatom MJXc-space1"><span id="MJXc-Node-5053" class="mjx-mrow"><span id="MJXc-Node-5054" class="mjx-msup"><span class="mjx-base"><span id="MJXc-Node-5055" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.475em; padding-bottom: 0.265em;">θ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-5056" class="mjx-mo" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.265em; padding-bottom: 0.318em;">′</span></span></span></span></span></span><span id="MJXc-Node-5057" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.055em; padding-bottom: 0.318em;">=</span></span><span id="MJXc-Node-5058" class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.37em;">sin</span></span><span id="MJXc-Node-5059" class="mjx-mo"><span class="mjx-char"></span></span><span id="MJXc-Node-5060" class="mjx-texatom MJXc-space1"><span id="MJXc-Node-5061" class="mjx-mrow"><span id="MJXc-Node-5062" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.475em; padding-bottom: 0.265em;">θ</span></span></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>ior</mtext><mo>⋅</mo><mi>sin</mi><mo>⁡</mo><mrow class="MJX-TeXAtom-ORD"><msup><mi>θ</mi><mo>′</mo></msup></mrow><mo>=</mo><mi>sin</mi><mo>⁡</mo><mrow class="MJX-TeXAtom-ORD"><mi>θ</mi></mrow></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-268">\text{ior}\cdot\sin{\theta'} = \sin{\theta}</script></span></p><p><span>So </span><span class="mathjax"><span class="MathJax_Preview" style="color: inherit;"></span><span id="MathJax-Element-269-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>&amp;#x03B7;</mi><mo>=</mo><mfrac><mn>1</mn><mtext>ior</mtext></mfrac></math>" role="presentation" style="font-size: 119%; position: relative;"><span id="MJXc-Node-5063" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-5064" class="mjx-mrow"><span id="MJXc-Node-5065" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.213em; padding-bottom: 0.475em; padding-right: 0.006em;">η</span></span><span id="MJXc-Node-5066" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.055em; padding-bottom: 0.318em;">=</span></span><span id="MJXc-Node-5067" class="mjx-mfrac MJXc-space3"><span class="mjx-box MJXc-stacked" style="width: 0.969em; padding: 0px 0.12em;"><span class="mjx-numerator" style="font-size: 70.7%; width: 1.37em; top: -1.298em;"><span id="MJXc-Node-5068" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.318em;">1</span></span></span><span class="mjx-denominator" style="font-size: 70.7%; width: 1.37em; bottom: -0.604em;"><span id="MJXc-Node-5069" class="mjx-mtext" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.37em;">ior</span></span></span><span class="mjx-line" style="border-bottom-width: 1.3px; border-bottom-style: solid; top: -0.283em; width: 0.969em;"></span></span><span class="mjx-vsize" style="height: 1.344em; vertical-align: -0.427em;"></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>η</mi><mo>=</mo><mfrac><mn>1</mn><mtext>ior</mtext></mfrac></math></span></span><script type="math/tex" id="MathJax-Element-269">\eta = \frac{1}{\text{ior}}</script></span></p><p><span>If exiting snell’s law is</span></p><p><span class="mathjax"><span class="MathJax_Preview" style="color: inherit;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-270-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>sin</mi><mo>&amp;#x2061;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msup><mi>&amp;#x03B8;</mi><mo>&amp;#x2032;</mo></msup></mrow><mo>=</mo><mtext>ior</mtext><mo>&amp;#x22C5;</mo><mi>sin</mi><mo>&amp;#x2061;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>&amp;#x03B8;</mi></mrow></math>" role="presentation" style="font-size: 119%; text-align: center; position: relative;"><span id="MJXc-Node-5070" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-5071" class="mjx-mrow"><span id="MJXc-Node-5072" class="mjx-mi"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.37em;">sin</span></span><span id="MJXc-Node-5073" class="mjx-mo"><span class="mjx-char"></span></span><span id="MJXc-Node-5074" class="mjx-texatom MJXc-space1"><span id="MJXc-Node-5075" class="mjx-mrow"><span id="MJXc-Node-5076" class="mjx-msup"><span class="mjx-base"><span id="MJXc-Node-5077" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.475em; padding-bottom: 0.265em;">θ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-5078" class="mjx-mo" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.265em; padding-bottom: 0.318em;">′</span></span></span></span></span></span><span id="MJXc-Node-5079" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.055em; padding-bottom: 0.318em;">=</span></span><span id="MJXc-Node-5080" class="mjx-mtext MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.37em;">ior</span></span><span id="MJXc-Node-5081" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.003em; padding-bottom: 0.318em;">⋅</span></span><span id="MJXc-Node-5082" class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.37em;">sin</span></span><span id="MJXc-Node-5083" class="mjx-mo"><span class="mjx-char"></span></span><span id="MJXc-Node-5084" class="mjx-texatom MJXc-space1"><span id="MJXc-Node-5085" class="mjx-mrow"><span id="MJXc-Node-5086" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.475em; padding-bottom: 0.265em;">θ</span></span></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>sin</mi><mo>⁡</mo><mrow class="MJX-TeXAtom-ORD"><msup><mi>θ</mi><mo>′</mo></msup></mrow><mo>=</mo><mtext>ior</mtext><mo>⋅</mo><mi>sin</mi><mo>⁡</mo><mrow class="MJX-TeXAtom-ORD"><mi>θ</mi></mrow></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-270">\sin{\theta'} = \text{ior}\cdot\sin{\theta}</script></span></p><p><span>So </span><span class="mathjax"><span class="MathJax_Preview" style="color: inherit;"></span><span id="MathJax-Element-271-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>&amp;#x03B7;</mi><mo>=</mo><mtext>ior</mtext></math>" role="presentation" style="font-size: 119%; position: relative;"><span id="MJXc-Node-5087" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-5088" class="mjx-mrow"><span id="MJXc-Node-5089" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.213em; padding-bottom: 0.475em; padding-right: 0.006em;">η</span></span><span id="MJXc-Node-5090" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.055em; padding-bottom: 0.318em;">=</span></span><span id="MJXc-Node-5091" class="mjx-mtext MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.37em;">ior</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>η</mi><mo>=</mo><mtext>ior</mtext></math></span></span><script type="math/tex" id="MathJax-Element-271">\eta = \text{ior}</script></span></p><p><span>We also have to consider if there is total internal reflection, this happens when the angle of incidence is so shallow the light won’t permeate the material, rather it would reflect internally.</span></p><p><span>This can be derived from snell’s law to find the condition that if</span></p><p><span class="mathjax"><span class="MathJax_Preview" style="color: inherit;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-272-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mn>1</mn><mo>&amp;#x2212;</mo><msup><mi>&amp;#x03B7;</mi><mn>2</mn></msup><mo stretchy=&quot;false&quot;>(</mo><mn>1</mn><mo>&amp;#x2212;</mo><msup><mi>cos</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>2</mn></mrow></msup><mo>&amp;#x2061;</mo><mi>&amp;#x03B8;</mi><mo stretchy=&quot;false&quot;>)</mo><mo>&amp;lt;</mo><mn>0</mn></math>" role="presentation" style="font-size: 119%; text-align: center; position: relative;"><span id="MJXc-Node-5092" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-5093" class="mjx-mrow"><span id="MJXc-Node-5094" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.318em;">1</span></span><span id="MJXc-Node-5095" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.318em; padding-bottom: 0.423em;">−</span></span><span id="MJXc-Node-5096" class="mjx-msubsup MJXc-space2"><span class="mjx-base" style="margin-right: -0.006em;"><span id="MJXc-Node-5097" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.213em; padding-bottom: 0.475em; padding-right: 0.006em;">η</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0.082em; padding-right: 0.071em;"><span id="MJXc-Node-5098" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.318em;">2</span></span></span></span><span id="MJXc-Node-5099" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.475em; padding-bottom: 0.58em;">(</span></span><span id="MJXc-Node-5100" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.318em;">1</span></span><span id="MJXc-Node-5101" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.318em; padding-bottom: 0.423em;">−</span></span><span id="MJXc-Node-5102" class="mjx-msubsup MJXc-space2"><span class="mjx-base"><span id="MJXc-Node-5103" class="mjx-mi"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.16em; padding-bottom: 0.37em;">cos</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-5104" class="mjx-texatom" style=""><span id="MJXc-Node-5105" class="mjx-mrow"><span id="MJXc-Node-5106" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.318em;">2</span></span></span></span></span></span><span id="MJXc-Node-5107" class="mjx-mo"><span class="mjx-char"></span></span><span id="MJXc-Node-5108" class="mjx-mi MJXc-space1"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.475em; padding-bottom: 0.265em;">θ</span></span><span id="MJXc-Node-5109" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.475em; padding-bottom: 0.58em;">)</span></span><span id="MJXc-Node-5110" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.265em; padding-bottom: 0.37em;">&lt;</span></span><span id="MJXc-Node-5111" class="mjx-mn MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.37em;">0</span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mn>1</mn><mo>−</mo><msup><mi>η</mi><mn>2</mn></msup><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msup><mi>cos</mi><mrow class="MJX-TeXAtom-ORD"><mn>2</mn></mrow></msup><mo>⁡</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mn>0</mn></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-272">1-\eta^2(1-\cos^{2}\theta) < 0</script></span></p><p><span>then there is total internal reflection.</span></p><p><span>We implement all this logic in </span><code>BSDF::refract</code><span> along with the following calculations for the relation between </span><code>wo</code><span> and </span><code>wi</code><span> using spherical coordinates:</span></p><pre><code class="wrap cpp hljs"><span class="token keyword">float</span> total_reflection <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> eta <span class="token operator">*</span> eta <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token punctuation">(</span>wo<span class="token punctuation">.</span>z <span class="token operator">*</span> wo<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

wi<span class="token operator">-&gt;</span>x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1.</span> <span class="token operator">*</span> eta <span class="token operator">*</span> wo<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
wi<span class="token operator">-&gt;</span>y <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1.</span> <span class="token operator">*</span> eta <span class="token operator">*</span> wo<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>wo<span class="token punctuation">.</span>z <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Entering object</span>
    wi<span class="token operator">-&gt;</span>z <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1.</span> <span class="token operator">*</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>total_reflection<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// Exiting object</span>
    wi<span class="token operator">-&gt;</span>z <span class="token operator">=</span> <span class="token number">1.</span> <span class="token operator">*</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>total_reflection<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><span>The case structure for </span><code>wo.z</code><span> guarantees the direction of </span><code>wo</code><span> is opposite </span><code>wi</code><span> w.r.t. the material’s surface.</span></p><p><span>When implementing </span><code>RefractionBSDF::sample_f()</code><span> we return an empty </span><code>Vector3D</code><span> if there is total internal reflection.</span></p><p><span>When refraction happens we return </span><code>transmittance / abs_cos_theta(*wi) / eta^2</code><span> with </span><code>*pdf = 1.</code><span> since radiance concentrates when a ray enters a high index of refraction material. </span><code>abs_cos_theta(*wi)</code><span> term is present to cancel out the cosine term in </span><code>at_least_one_bounce_radiance</code></p><h4 id="Glass" data-id="Glass"><a class="anchor hidden-xs" href="#Glass" title="Glass"><span class="octicon octicon-link"></span></a><span>Glass</span></h4><p><span>Glass material uses both reflection and refraction. If we have total internal reflection we just send the next ray to reflect and return an empty </span><code>Vector3D</code><span>.</span></p><p><span>Otherwise, we want to compute the proportion of reflection to refraction of a material depending on the angle the camera is looking at the object known as the fresnel factor.</span></p><p><span>The factor is</span></p><p><span class="mathjax"><span class="MathJax_Preview" style="color: inherit;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-273-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>R</mi><mn>0</mn></msub><mo>=</mo><msup><mrow><mo>(</mo><mfrac><mrow><mi>&amp;#x03B7;</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow><mrow><mi>&amp;#x03B7;</mi><mo>+</mo><mn>1</mn></mrow></mfrac><mo>)</mo></mrow><mn>2</mn></msup><mspace width=&quot;2em&quot; /><mi>R</mi><mo stretchy=&quot;false&quot;>(</mo><mi>&amp;#x03B8;</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><msub><mi>R</mi><mn>0</mn></msub><mo>+</mo><mo stretchy=&quot;false&quot;>(</mo><mn>1</mn><mo>&amp;#x2212;</mo><msub><mi>R</mi><mn>0</mn></msub><mo stretchy=&quot;false&quot;>)</mo><mo stretchy=&quot;false&quot;>(</mo><mn>1</mn><mo>&amp;#x2212;</mo><mi>cos</mi><mo>&amp;#x2061;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>&amp;#x03B8;</mi></mrow><msup><mo stretchy=&quot;false&quot;>)</mo><mn>5</mn></msup></math>" role="presentation" style="font-size: 119%; text-align: center; position: relative;"><span id="MJXc-Node-5112" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-5113" class="mjx-mrow"><span id="MJXc-Node-5114" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-5115" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.475em; padding-bottom: 0.318em;">R</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-5116" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.37em;">0</span></span></span></span><span id="MJXc-Node-5117" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.055em; padding-bottom: 0.318em;">=</span></span><span id="MJXc-Node-5118" class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span id="MJXc-Node-5119" class="mjx-mrow"><span id="MJXc-Node-5120" class="mjx-mo"><span class="mjx-char MJXc-TeX-size3-R" style="padding-top: 1.211em; padding-bottom: 1.211em;">(</span></span><span id="MJXc-Node-5121" class="mjx-mfrac"><span class="mjx-box MJXc-stacked" style="width: 2.425em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 2.425em; top: -1.406em;"><span id="MJXc-Node-5122" class="mjx-mrow"><span id="MJXc-Node-5123" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.213em; padding-bottom: 0.475em; padding-right: 0.006em;">η</span></span><span id="MJXc-Node-5124" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.318em; padding-bottom: 0.423em;">−</span></span><span id="MJXc-Node-5125" class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.318em;">1</span></span></span></span><span class="mjx-denominator" style="width: 2.425em; bottom: -0.927em;"><span id="MJXc-Node-5126" class="mjx-mrow"><span id="MJXc-Node-5127" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.213em; padding-bottom: 0.475em; padding-right: 0.006em;">η</span></span><span id="MJXc-Node-5128" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.318em; padding-bottom: 0.423em;">+</span></span><span id="MJXc-Node-5129" class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.318em;">1</span></span></span></span><span class="mjx-line" style="border-bottom-width: 1.3px; border-bottom-style: solid; top: -0.283em; width: 2.425em;"></span></span><span class="mjx-vsize" style="height: 2.333em; vertical-align: -0.927em;"></span></span><span id="MJXc-Node-5130" class="mjx-mo"><span class="mjx-char MJXc-TeX-size3-R" style="padding-top: 1.211em; padding-bottom: 1.211em;">)</span></span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 1.7em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-5131" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.318em;">2</span></span></span></span><span id="MJXc-Node-5132" class="mjx-mspace" style="width: 2em; height: 0px;"></span><span id="MJXc-Node-5133" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.475em; padding-bottom: 0.318em;">R</span></span><span id="MJXc-Node-5134" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.475em; padding-bottom: 0.58em;">(</span></span><span id="MJXc-Node-5135" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.475em; padding-bottom: 0.265em;">θ</span></span><span id="MJXc-Node-5136" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.475em; padding-bottom: 0.58em;">)</span></span><span id="MJXc-Node-5137" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.055em; padding-bottom: 0.318em;">=</span></span><span id="MJXc-Node-5138" class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span id="MJXc-Node-5139" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.475em; padding-bottom: 0.318em;">R</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-5140" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.37em;">0</span></span></span></span><span id="MJXc-Node-5141" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.318em; padding-bottom: 0.423em;">+</span></span><span id="MJXc-Node-5142" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.475em; padding-bottom: 0.58em;">(</span></span><span id="MJXc-Node-5143" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.318em;">1</span></span><span id="MJXc-Node-5144" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.318em; padding-bottom: 0.423em;">−</span></span><span id="MJXc-Node-5145" class="mjx-msubsup MJXc-space2"><span class="mjx-base"><span id="MJXc-Node-5146" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.475em; padding-bottom: 0.318em;">R</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-5147" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.37em;">0</span></span></span></span><span id="MJXc-Node-5148" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.475em; padding-bottom: 0.58em;">)</span></span><span id="MJXc-Node-5149" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.475em; padding-bottom: 0.58em;">(</span></span><span id="MJXc-Node-5150" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.318em;">1</span></span><span id="MJXc-Node-5151" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.318em; padding-bottom: 0.423em;">−</span></span><span id="MJXc-Node-5152" class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.16em; padding-bottom: 0.37em;">cos</span></span><span id="MJXc-Node-5153" class="mjx-mo"><span class="mjx-char"></span></span><span id="MJXc-Node-5154" class="mjx-texatom MJXc-space1"><span id="MJXc-Node-5155" class="mjx-mrow"><span id="MJXc-Node-5156" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.475em; padding-bottom: 0.265em;">θ</span></span></span></span><span id="MJXc-Node-5157" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-5158" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.475em; padding-bottom: 0.58em;">)</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-5159" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.37em;">5</span></span></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>R</mi><mn>0</mn></msub><mo>=</mo><msup><mrow><mo>(</mo><mfrac><mrow><mi>η</mi><mo>−</mo><mn>1</mn></mrow><mrow><mi>η</mi><mo>+</mo><mn>1</mn></mrow></mfrac><mo>)</mo></mrow><mn>2</mn></msup><mspace width="2em"></mspace><mi>R</mi><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mi>R</mi><mn>0</mn></msub><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mi>R</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>cos</mi><mo>⁡</mo><mrow class="MJX-TeXAtom-ORD"><mi>θ</mi></mrow><msup><mo stretchy="false">)</mo><mn>5</mn></msup></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-273">R_0 = \left(\frac{\eta-1}{\eta + 1}\right)^2
\qquad R(\theta) = R_0 + (1-R_0)(1-\cos{\theta})^5</script></span></p><p><span>We use </span><code>coin_flip(R)</code><span> to then decide whether the ray will be reflected or refracted. The implemntation for </span><code>GlassBSDF::sample_f()</code><span>'s reflection and refraction are similar we multiply the returned value by </span><code>*pdf</code><span> which is </span><code>R</code><span> for reflection and </span><code>1-R</code><span> for refraction.</span></p><h3 id="Bounce-Stack" data-id="Bounce-Stack"><a class="anchor hidden-xs" href="#Bounce-Stack" title="Bounce-Stack"><span class="octicon octicon-link"></span></a><span>Bounce Stack</span></h3><p><span>Bounce 0</span></p><p><img src="https://i.imgur.com/aM6RAjQ.png" alt="" loading="lazy"></p><p><span>We just get the source light as expected</span></p><p><span>Bounce 1</span></p><p><img src="https://i.imgur.com/0g9zKPs.png" alt="" loading="lazy"></p><p><span>There are not enough bounces yet to reflect anything besides the source light since at this level, the balls do not see the other objects as illuminiated. Also notice the right glass ball has a “grainier” reflection than the right, this is due to the fresnel coefficient not being 100% reflection and even though the sample rate is 512, we need more samples to smooth it out.</span></p><p><span>Bounce 2</span></p><p><img src="https://i.imgur.com/0pt7UXK.jpg" alt="" loading="lazy"></p><p><span>There we go! At two bounces we can see mirrored surfaces going from light -&gt; reflective object -&gt; reflected object. The glass material is still mostly black since the light ray at bounce 2 is internal and has not yet escaped.</span></p><p><span>Bounce 3</span></p><p><img src="https://i.imgur.com/sfBv1Nb.jpg" alt="" loading="lazy"></p><p><span>Now we can see refraction! Notice the reflection on the left ball still has the right ball as black. This is because the reflection sees the glass ball as we do in the Bounce 2 case.</span></p><p><span>There is also a large caustic pattern that shows up on the bottom of the ball, this is due to light refracting from the ball onto the floor and concentrating there.</span></p><p><span>Bounce 4</span></p><p><img src="https://i.imgur.com/fvBozxB.jpg" alt="" loading="lazy"></p><p><span>We have two new elements at bounce four, the glass ball is now accurately reflected in the mirror ball. This is because we now are at enough bounces for not only light to escape the glass ball’s refractioin, but to go from the mirror ball to the camera.</span></p><p><span>We also have a small caustic pattern showing up on the blue wall. This is also from the glass ball. I believe this smaller caustic pattern is from the mirrored ball’s reflectiion of the light sources. light -&gt; mirror ball -&gt; glass ball -&gt; glass ball internal -&gt; blue wall.</span></p><p><span>Bounce 5</span></p><p><img src="https://i.imgur.com/EnLb4tq.jpg" alt="" loading="lazy"></p><p><span>We don’t notice any new elements, this is just brighterr than the last.</span></p><p><span>Bounce 100</span></p><p><img src="https://i.imgur.com/ye11WrK.jpg" alt="" loading="lazy"></p><p><span>This one is similar to the previous case except there’s more noise on the glass ball near the top.</span></p><h2 id="Part-4" data-id="Part-4"><a class="anchor hidden-xs" href="#Part-4" title="Part-4"><span class="octicon octicon-link"></span></a><span>Part 4</span></h2><p><span>In this part, we introduce a depth of field to our virtual camera using a thin lens model that can change its aperture and focus distance. The difference between a pinhole and thin lens is that a pinhole has a one-to-one correspondence for points in the world to location on the lens so everything is in focus. A thin lens is more realistic since there is a circle of locations on the lens that can map to the same point. We get blurriness when multiple points map to the same location on the camera’s sensor.</span></p><h3 id="Implementation1" data-id="Implementation"><a class="anchor hidden-xs" href="#Implementation1" title="Implementation1"><span class="octicon octicon-link"></span></a><span>Implementation</span></h3><p><span>Basically, we want to get the blue vector to model our camera’s eye.</span></p><p><img src="https://i.imgur.com/cjTzvgu.jpg" alt="" loading="lazy"></p><p><span>Our implementation of</span></p><pre><code class="wrap cpp hljs">Ray <span class="token class-name">Camera</span><span class="token double-colon punctuation">::</span><span class="token function">generate_ray_for_thin_lens</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">,</span> <span class="token keyword">double</span> y<span class="token punctuation">,</span> <span class="token keyword">double</span> rndR<span class="token punctuation">,</span> <span class="token keyword">double</span> rndTheta<span class="token punctuation">)</span> <span class="token keyword">const</span>
</code></pre><p><span>starts by figuring the generated ray direction</span></p><pre><code class="wrap cpp hljs">x <span class="token operator">-=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
y <span class="token operator">-=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>

x <span class="token operator">*=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token function">tan</span><span class="token punctuation">(</span><span class="token number">0.5</span> <span class="token operator">*</span> <span class="token function">radians</span><span class="token punctuation">(</span>hFov<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
y <span class="token operator">*=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token function">tan</span><span class="token punctuation">(</span><span class="token number">0.5</span> <span class="token operator">*</span> <span class="token function">radians</span><span class="token punctuation">(</span>vFov<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><span>Next we want to uniformally sample the disk representing the thin lens</span></p><pre><code class="wrap cpp hljs">Vector3D <span class="token function">pLens</span><span class="token punctuation">(</span>lensRadius <span class="token operator">*</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>rndR<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">cos</span><span class="token punctuation">(</span>rndTheta<span class="token punctuation">)</span><span class="token punctuation">,</span> lensRadius <span class="token operator">*</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>rndR<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">sin</span><span class="token punctuation">(</span>rndTheta<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><span>this is the blue point on lens </span><span class="mathjax"><span class="MathJax_Preview" style="color: inherit;"></span><span id="MathJax-Element-279-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>(</mo><msub><mi>s</mi><mi>x</mi></msub><mo>,</mo><msub><mi>s</mi><mi>y</mi></msub><mo>,</mo><mn>0</mn><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="font-size: 119%; position: relative;"><span id="MJXc-Node-5225" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-5226" class="mjx-mrow"><span id="MJXc-Node-5227" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.475em; padding-bottom: 0.58em;">(</span></span><span id="MJXc-Node-5228" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-5229" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.213em; padding-bottom: 0.265em;">s</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-5230" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.213em; padding-bottom: 0.265em;">x</span></span></span></span><span id="MJXc-Node-5231" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.155em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-5232" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-5233" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.213em; padding-bottom: 0.265em;">s</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-5234" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.213em; padding-bottom: 0.475em; padding-right: 0.006em;">y</span></span></span></span><span id="MJXc-Node-5235" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.155em; padding-bottom: 0.528em;">,</span></span><span id="MJXc-Node-5236" class="mjx-mn MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.37em; padding-bottom: 0.37em;">0</span></span><span id="MJXc-Node-5237" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.475em; padding-bottom: 0.58em;">)</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><msub><mi>s</mi><mi>x</mi></msub><mo>,</mo><msub><mi>s</mi><mi>y</mi></msub><mo>,</mo><mn>0</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-279">(s_x, s_y, 0)</script></span></p><p><span>To get the point in focus we just invert the current pixel and scale it by </span><code>focalDistance</code></p><pre><code class="wrap cpp hljs">Vector3D <span class="token function">pFocus</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pFocus <span class="token operator">*=</span> focalDistance<span class="token punctuation">;</span>
</code></pre><p><span>We now have the point in focus!</span></p><p><span>Finally we want the direction of the blue vector, this is simply the point in focus minus our sampled lens point.</span></p><pre><code class="wrap cpp hljs">Vector3D pDir <span class="token operator">=</span> pFocus <span class="token operator">-</span> pLens<span class="token punctuation">;</span>

pDir<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><span>With this we generate a new ray after transforming the points in camera space to world space and setting the bounds.</span></p><pre><code class="wrap cpp hljs">Ray <span class="token function">newRay</span><span class="token punctuation">(</span>c2w <span class="token operator">*</span> <span class="token punctuation">(</span>pLens<span class="token punctuation">)</span> <span class="token operator">+</span> pos<span class="token punctuation">,</span> c2w <span class="token operator">*</span> pDir<span class="token punctuation">)</span><span class="token punctuation">;</span>

newRay<span class="token punctuation">.</span>max_t <span class="token operator">=</span> fClip<span class="token punctuation">;</span>
newRay<span class="token punctuation">.</span>min_t <span class="token operator">=</span> nClip<span class="token punctuation">;</span>
</code></pre><h3 id="Focus-Stack" data-id="Focus-Stack"><a class="anchor hidden-xs" href="#Focus-Stack" title="Focus-Stack"><span class="octicon octicon-link"></span></a><span>Focus Stack</span></h3><p><span>Each image here is rendered with 512 samples and a 0.23 aperture radius</span></p><p><img src="https://i.imgur.com/y1mOn7l.jpg" alt="" loading="lazy"><br>
<img src="https://i.imgur.com/ncWFofJ.jpg" alt="" loading="lazy"><br>
<img src="https://i.imgur.com/dk8piDq.jpg" alt="" loading="lazy"><br>
<img src="https://i.imgur.com/KaZP1hU.jpg" alt="" loading="lazy"></p><p><span>The focus is pulled here from back to front with a very thin DOF. The size of a circle of confusion is proportional to the distance it is away from the plane of focus.</span></p><h3 id="Aperture-Stack" data-id="Aperture-Stack"><a class="anchor hidden-xs" href="#Aperture-Stack" title="Aperture-Stack"><span class="octicon octicon-link"></span></a><span>Aperture Stack</span></h3><p><span>Each image here is rendered with 512 samples at the same focal distance</span></p><p><span>aperture radius = 0.23</span><br>
<img src="https://i.imgur.com/UXuzyir.jpg" alt="" loading="lazy"></p><p><span>aperture radius = 0.15</span><br>
<img src="https://i.imgur.com/BmGFtp2.jpg" alt="" loading="lazy"></p><p><span>aperture radius = 0.10</span><br>
<img src="https://i.imgur.com/FYQnObi.jpg" alt="" loading="lazy"></p><p><span>aperture radius = 0.05</span><br>
<img src="https://i.imgur.com/gGYLPR7.jpg" alt="" loading="lazy"></p><p><span>As the aperture radius becomes smaller we approach a pinhole camera, which is why we see the DOF become larger. The circle of confusion on the dragon’s teeth also becomes much smaller with lower aperture.</span></p><h2 id="Collaboration" data-id="Collaboration"><a class="anchor hidden-xs" href="#Collaboration" title="Collaboration"><span class="octicon octicon-link"></span></a><span>Collaboration</span></h2><p><span>Both partners contributed equally to this project. It was shorter than normal so there weren’t any major bugs besides forgeting to change coordinates or inverting signs. The most interesting thing we learned is how DOF is modelled and how to create it ourselves usiing some basic linear algebra.</span></p><p><span>Link:</span><br>
<a href="https://cal-cs184-student.github.io/project-webpages-sp23-CardiacMangoes/proj3-2/index.html" target="_blank" rel="noopener"><span>https://cal-cs184-student.github.io/project-webpages-sp23-CardiacMangoes/proj3-2/index.html</span></a></p></div>
    <div class="ui-toc dropup unselectable hidden-print" style="display:none;">
        <div class="pull-right dropdown">
            <a id="tocLabel" class="ui-toc-label btn btn-default" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" title="Table of content">
                <i class="fa fa-bars"></i>
            </a>
            <ul id="ui-toc" class="ui-toc-dropdown dropdown-menu" aria-labelledby="tocLabel">
                <div class="toc"><ul class="nav">
<li><a href="#CS-184-Project-3-2-Writeup" title="CS 184 Project 3-2 Writeup">CS 184 Project 3-2 Writeup</a><ul class="nav">
<li><a href="#Overview" title="Overview">Overview</a></li>
<li><a href="#Part-1" title="Part 1">Part 1</a><ul class="nav">
<li><a href="#Implementation" title="Implementation">Implementation</a></li>
<li><a href="#Bounce-Stack" title="Bounce Stack">Bounce Stack</a></li>
</ul>
</li>
<li><a href="#Part-4" title="Part 4">Part 4</a><ul class="nav">
<li><a href="#Implementation1" title="Implementation">Implementation</a></li>
<li><a href="#Focus-Stack" title="Focus Stack">Focus Stack</a></li>
<li><a href="#Aperture-Stack" title="Aperture Stack">Aperture Stack</a></li>
</ul>
</li>
<li><a href="#Collaboration" title="Collaboration">Collaboration</a></li>
</ul>
</li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
            </ul>
        </div>
    </div>
    <div id="ui-toc-affix" class="ui-affix-toc ui-toc-dropdown unselectable hidden-print" data-spy="affix" style="top:17px;display:none;" null null>
        <div class="toc"><ul class="nav">
<li><a href="#CS-184-Project-3-2-Writeup" title="CS 184 Project 3-2 Writeup">CS 184 Project 3-2 Writeup</a><ul class="nav">
<li><a href="#Overview" title="Overview">Overview</a></li>
<li><a href="#Part-1" title="Part 1">Part 1</a><ul class="nav">
<li><a href="#Implementation" title="Implementation">Implementation</a></li>
<li><a href="#Bounce-Stack" title="Bounce Stack">Bounce Stack</a></li>
</ul>
</li>
<li><a href="#Part-4" title="Part 4">Part 4</a><ul class="nav">
<li><a href="#Implementation1" title="Implementation">Implementation</a></li>
<li><a href="#Focus-Stack" title="Focus Stack">Focus Stack</a></li>
<li><a href="#Aperture-Stack" title="Aperture Stack">Aperture Stack</a></li>
</ul>
</li>
<li><a href="#Collaboration" title="Collaboration">Collaboration</a></li>
</ul>
</li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gist-embed/2.6.0/gist-embed.min.js" integrity="sha256-KyF2D6xPIJUW5sUDSs93vWyZm+1RzIpKCexxElmxl8g=" crossorigin="anonymous" defer></script>
    <script>
        var markdown = $(".markdown-body");
        //smooth all hash trigger scrolling
        function smoothHashScroll() {
            var hashElements = $("a[href^='#']").toArray();
            for (var i = 0; i < hashElements.length; i++) {
                var element = hashElements[i];
                var $element = $(element);
                var hash = element.hash;
                if (hash) {
                    $element.on('click', function (e) {
                        // store hash
                        var hash = this.hash;
                        if ($(hash).length <= 0) return;
                        // prevent default anchor click behavior
                        e.preventDefault();
                        // animate
                        $('body, html').stop(true, true).animate({
                            scrollTop: $(hash).offset().top
                        }, 100, "linear", function () {
                            // when done, add hash to url
                            // (default click behaviour)
                            window.location.hash = hash;
                        });
                    });
                }
            }
        }

        smoothHashScroll();
        var toc = $('.ui-toc');
        var tocAffix = $('.ui-affix-toc');
        var tocDropdown = $('.ui-toc-dropdown');
        //toc
        tocDropdown.click(function (e) {
            e.stopPropagation();
        });

        var enoughForAffixToc = true;

        function generateScrollspy() {
            $(document.body).scrollspy({
                target: ''
            });
            $(document.body).scrollspy('refresh');
            if (enoughForAffixToc) {
                toc.hide();
                tocAffix.show();
            } else {
                tocAffix.hide();
                toc.show();
            }
            $(document.body).scroll();
        }

        function windowResize() {
            //toc right
            var paddingRight = parseFloat(markdown.css('padding-right'));
            var right = ($(window).width() - (markdown.offset().left + markdown.outerWidth() - paddingRight));
            toc.css('right', right + 'px');
            //affix toc left
            var newbool;
            var rightMargin = (markdown.parent().outerWidth() - markdown.outerWidth()) / 2;
            //for ipad or wider device
            if (rightMargin >= 133) {
                newbool = true;
                var affixLeftMargin = (tocAffix.outerWidth() - tocAffix.width()) / 2;
                var left = markdown.offset().left + markdown.outerWidth() - affixLeftMargin;
                tocAffix.css('left', left + 'px');
            } else {
                newbool = false;
            }
            if (newbool != enoughForAffixToc) {
                enoughForAffixToc = newbool;
                generateScrollspy();
            }
        }
        $(window).resize(function () {
            windowResize();
        });
        $(document).ready(function () {
            windowResize();
            generateScrollspy();
        });

        //remove hash
        function removeHash() {
            window.location.hash = '';
        }

        var backtotop = $('.back-to-top');
        var gotobottom = $('.go-to-bottom');

        backtotop.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToTop)
                scrollToTop();
            removeHash();
        });
        gotobottom.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToBottom)
                scrollToBottom();
            removeHash();
        });

        var toggle = $('.expand-toggle');
        var tocExpand = false;

        checkExpandToggle();
        toggle.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            tocExpand = !tocExpand;
            checkExpandToggle();
        })

        function checkExpandToggle () {
            var toc = $('.ui-toc-dropdown .toc');
            var toggle = $('.expand-toggle');
            if (!tocExpand) {
                toc.removeClass('expand');
                toggle.text('Expand all');
            } else {
                toc.addClass('expand');
                toggle.text('Collapse all');
            }
        }

        function scrollToTop() {
            $('body, html').stop(true, true).animate({
                scrollTop: 0
            }, 100, "linear");
        }

        function scrollToBottom() {
            $('body, html').stop(true, true).animate({
                scrollTop: $(document.body)[0].scrollHeight
            }, 100, "linear");
        }
    </script>
</body>

</html>
